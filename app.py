import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# 设置页面配置 - 使用暗色主题
st.set_page_config(
    page_title="制药工艺流程对比",
    page_icon="⚗️",
    layout="wide",
    initial_sidebar_state="expanded"
)

# 应用CSS样式 - 暗色专业主题
st.markdown("""
<style>
    /* 全局暗色主题 */
    .main {
        background-color: #0e1117;
        color: #f0f2f6;
    }
    
    .stApp {
        background: linear-gradient(135deg, #0e1117 0%, #1a1d2e 100%);
    }
    
    /* 侧边栏样式 */
    section[data-testid="stSidebar"] {
        background-color: #1a1d2e;
        border-right: 1px solid #2d3746;
    }
    
    /* 标题样式 */
    h1, h2, h3, h4, h5, h6 {
        color: #ffffff !important;
        font-weight: 600;
    }
    
    /* 文本样式 */
    p, li, div, span {
        color: #e0e0e0 !important;
    }
    
    /* 卡片和容器样式 */
    .stExpander {
        background-color: #1e2130;
        border: 1px solid #2d3746;
        border-radius: 10px;
    }
    
    .stMetric {
        background-color: #1e2130;
        border: 1px solid #2d3746;
        border-radius: 8px;
        padding: 15px;
    }
    
    /* 按钮样式 */
    .stButton > button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .stButton > button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    /* 标签页样式 */
    .stTabs [data-baseweb="tab-list"] {
        gap: 2px;
        background-color: #1a1d2e;
        padding: 8px;
        border-radius: 8px;
    }
    
    .stTabs [data-baseweb="tab"] {
        background-color: #1e2130;
        border-radius: 6px 6px 0 0;
        padding: 10px 20px;
        border: 1px solid #2d3746;
        color: #b0b0b0;
    }
    
    .stTabs [aria-selected="true"] {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white !important;
        border: none;
    }
    
    /* 数据表格样式 */
    .dataframe {
        background-color: #1e2130 !important;
        color: #ffffff !important;
    }
    
    .dataframe th {
        background-color: #2d3746 !important;
        color: white !important;
        font-weight: 600;
    }
    
    .dataframe td {
        background-color: #1e2130 !important;
        color: #e0e0e0 !important;
        border-color: #2d3746 !important;
    }
    
    /* 选择框样式 */
    .stSelectbox, .stMultiselect, .stRadio {
        background-color: #1e2130;
        border-radius: 8px;
        padding: 5px;
    }
    
    /* 警告框样式 */
    .stAlert {
        background-color: #2d3746;
        border: 1px solid #667eea;
        border-radius: 8px;
    }
    
    /* 图表容器 */
    .js-plotly-plot {
        background-color: #1e2130 !important;
        border-radius: 10px;
        padding: 15px;
        border: 1px solid #2d3746;
    }
    
    /* 自定义卡片 */
    .custom-card {
        background: linear-gradient(135deg, #1e2130 0%, #2d3746 100%);
        border: 1px solid #3a4359;
        border-radius: 12px;
        padding: 20px;
        margin: 10px 0;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }
    
    /* 流程图节点 */
    .process-node {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 8px;
        padding: 10px;
        margin: 5px;
        text-align: center;
        font-weight: 600;
        border: 2px solid rgba(255, 255, 255, 0.1);
    }
    
    /* 工艺步骤样式 */
    .step-card {
        background-color: #1e2130;
        border-left: 4px solid #667eea;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
    }
    
    .step-number {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-right: 10px;
    }
</style>
""", unsafe_allow_html=True)

# 应用标题
st.markdown('<h1 style="text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px;">⚗️ 制药工艺流程对比</h1>', unsafe_allow_html=True)
st.markdown('<h3 style="text-align: center; color: #b0b0b0; margin-bottom: 30px;">可视化展示不同制药品类的工艺步骤及其差异</h3>', unsafe_allow_html=True)

# 定义详细的制药工艺数据库
# class PharmaceuticalProcesses:
#     """制药工艺数据库"""
    
#     PROCESSES = {
#         # 1. 化学药物 - 固体制剂
#         "化学药物-固体制剂": {
#             "片剂": {
#                 "description": "最常见的口服固体制剂，通过粉末压缩成型",
#                 "关键特征": ["剂量准确", "稳定性好", "便于服用"],
#                 "工艺步骤": [
#                     {"name": "原料验收", "关键参数": ["含量", "杂质", "粒度"], "设备": ["天平", "筛分机"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "称配", "关键参数": ["称量精度", "复核确认"], "设备": ["精密天平"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "制粒", "关键参数": ["粘合剂浓度", "搅拌时间", "粒度分布"], "设备": ["湿法制粒机"], "时间(h)": 3, "温度(℃)": "25-35"},
#                     {"name": "干燥", "关键参数": ["温度", "时间", "水分含量"], "设备": ["流化床干燥机"], "时间(h)": 4, "温度(℃)": "50-60"},
#                     {"name": "整粒", "关键参数": ["筛网目数", "颗粒收率"], "设备": ["整粒机"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "总混", "关键参数": ["混合时间", "均匀度"], "设备": ["三维混合机"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "压片", "关键参数": ["压力", "硬度", "片重差异"], "设备": ["旋转压片机"], "时间(h)": 4, "温度(℃)": "室温"},
#                     {"name": "包衣", "关键参数": ["包衣液浓度", "喷雾速率", "温度"], "设备": ["包衣锅"], "时间(h)": 6, "温度(℃)": "40-50"},
#                     {"name": "包装", "关键参数": ["密封性", "标签准确性"], "设备": ["泡罩包装机"], "时间(h)": 3, "温度(℃)": "室温"}
#                 ]
#             },
            
#             "胶囊剂": {
#                 "description": "药物封装在明胶或植物胶囊中",
#                 "关键特征": ["掩盖不良味道", "提高生物利用度", "便于个性化"],
#                 "工艺步骤": [
#                     {"name": "原料处理", "关键参数": ["粒度", "流动性"], "设备": ["粉碎机", "筛分机"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "称配", "关键参数": ["称量精度"], "设备": ["精密天平"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "混合", "关键参数": ["混合均匀度"], "设备": ["V型混合机"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "胶囊填充", "关键参数": ["装量差异", "锁合完整性"], "设备": ["全自动胶囊填充机"], "时间(h)": 4, "温度(℃)": "20-25"},
#                     {"name": "抛光", "关键参数": ["外观", "清洁度"], "设备": ["胶囊抛光机"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "检查", "关键参数": ["外观", "重量差异"], "设备": ["胶囊检查机"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "包装", "关键参数": ["密封性", "防潮性"], "设备": ["装瓶机"], "时间(h)": 3, "温度(℃)": "室温"}
#                 ]
#             },
            
#             "颗粒剂": {
#                 "description": "药物与辅料制成的干燥颗粒状制剂",
#                 "关键特征": ["分散性好", "剂量准确", "便于儿童服用"],
#                 "工艺步骤": [
#                     {"name": "原料处理", "关键参数": ["粒度", "水分"], "设备": ["粉碎机"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "称配", "关键参数": ["配比准确性"], "设备": ["台秤"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "制粒", "关键参数": ["粒度分布", "收率"], "设备": ["干法制粒机"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "整粒", "关键参数": ["颗粒均匀度"], "设备": ["振荡筛"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "总混", "关键参数": ["混合均匀度"], "设备": ["双锥混合机"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "分装", "关键参数": ["装量差异"], "设备": ["自动分装机"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "包装", "关键参数": ["密封性"], "设备": ["袋包装机"], "时间(h)": 2, "温度(℃)": "室温"}
#                 ]
#             }
#         },
        
#         # 2. 化学药物 - 半固体制剂
#         "化学药物-半固体制剂": {
#             "软膏剂": {
#                 "description": "药物与油脂性或水溶性基质混合制成的半固体制剂",
#                 "关键特征": ["局部给药", "缓释作用", "保护创面"],
#                 "工艺步骤": [
#                     {"name": "基质处理", "关键参数": ["熔点", "纯净度"], "设备": ["加热罐"], "时间(h)": 2, "温度(℃)": "70-80"},
#                     {"name": "药物分散", "关键参数": ["分散均匀度", "粒度"], "设备": ["胶体磨"], "时间(h)": 3, "温度(℃)": "60-70"},
#                     {"name": "均质乳化", "关键参数": ["乳化时间", "温度", "pH值"], "设备": ["均质乳化机"], "时间(h)": 4, "温度(℃)": "60-70"},
#                     {"name": "脱气", "关键参数": ["气泡含量"], "设备": ["真空脱气罐"], "时间(h)": 1, "温度(℃)": "50-60"},
#                     {"name": "灌装", "关键参数": ["装量差异", "密封性"], "设备": ["软膏灌装机"], "时间(h)": 3, "温度(℃)": "40-50"},
#                     {"name": "包装", "关键参数": ["密封完整性"], "设备": ["旋盖机"], "时间(h)": 2, "温度(℃)": "室温"}
#                 ]
#             },
            
#             "凝胶剂": {
#                 "description": "药物与亲水性基质制成的透明或半透明半固体制剂",
#                 "关键特征": ["生物相容性好", "透皮吸收", "美观"],
#                 "工艺步骤": [
#                     {"name": "基质制备", "关键参数": ["粘度", "透明度"], "设备": ["搅拌罐"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "药物溶解", "关键参数": ["溶解度", "稳定性"], "设备": ["溶解罐"], "time(h)": 3, "温度(℃)": "室温"},
#                     {"name": "混合", "关键参数": ["混合均匀度"], "设备": ["行星搅拌机"], "时间(h)": 4, "温度(℃)": "室温"},
#                     {"name": "脱泡", "关键参数": ["气泡消除"], "设备": ["真空脱泡机"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "灌装", "关键参数": ["装量精度"], "设备": ["凝胶灌装机"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "包装", "关键参数": ["密封性"], "设备": ["铝管封尾机"], "时间(h)": 2, "温度(℃)": "室温"}
#                 ]
#             }
#         },
        
#         # 3. 化学药物 - 液体制剂
#         "化学药物-液体制剂": {
#             "注射剂": {
#                 "description": "供注入体内的无菌制剂",
#                 "关键特征": ["起效迅速", "生物利用度高", "无菌要求严格"],
#                 "工艺步骤": [
#                     {"name": "配液", "关键参数": ["浓度", "pH值", "澄明度"], "设备": ["配液罐"], "时间(h)": 3, "温度(℃)": "20-25"},
#                     {"name": "过滤", "关键参数": ["滤器完整性", "除菌效果"], "设备": ["除菌过滤器"], "时间(h)": 1, "温度(℃)": "20-25"},
#                     {"name": "灌封", "关键参数": ["灌装精度", "密封性"], "设备": ["洗烘灌封联动线"], "时间(h)": 4, "温度(℃)": "20-25"},
#                     {"name": "灭菌", "关键参数": ["温度", "时间", "F0值"], "设备": ["蒸汽灭菌柜"], "时间(h)": 2, "温度(℃)": "121"},
#                     {"name": "灯检", "关键参数": ["可见异物"], "设备": ["自动灯检机"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "贴签包装", "关键参数": ["标签准确性", "密封性"], "设备": ["贴标机"], "时间(h)": 2, "温度(℃)": "室温"}
#                 ]
#             },
            
#             "口服液": {
#                 "description": "供口服的液体制剂",
#                 "关键特征": ["吸收快", "便于儿童老人服用"],
#                 "工艺步骤": [
#                     {"name": "药材提取", "关键参数": ["提取率", "有效成分"], "设备": ["提取罐"], "时间(h)": 6, "温度(℃)": "80-90"},
#                     {"name": "过滤浓缩", "关键参数": ["澄清度", "相对密度"], "设备": ["真空浓缩器"], "时间(h)": 4, "温度(℃)": "60-70"},
#                     {"name": "配制", "关键参数": ["pH值", "糖度"], "设备": ["配液罐"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "过滤", "关键参数": ["澄明度"], "设备": ["板框过滤器"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "灌装", "关键参数": ["装量差异"], "设备": ["液体灌装机"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "灭菌", "关键参数": ["温度", "时间"], "设备": ["水浴灭菌柜"], "时间(h)": 1, "温度(℃)": "100"},
#                     {"name": "包装", "关键参数": ["密封完整性"], "设备": ["旋盖机"], "时间(h)": 2, "温度(℃)": "室温"}
#                 ]
#             }
#         },
        
#         # 4. 生物制品
#         "生物制品": {
#             "疫苗": {
#                 "description": "用于预防疾病的生物制品",
#                 "关键特征": ["免疫原性", "安全性", "稳定性"],
#                 "工艺步骤": [
#                     {"name": "细胞培养", "关键参数": ["细胞密度", "活力", "无菌"], "设备": ["生物反应器"], "时间(天)": 7, "温度(℃)": "37"},
#                     {"name": "病毒接种", "关键参数": ["MOI", "感染时间"], "设备": ["无菌操作台"], "时间(h)": 2, "温度(℃)": "37"},
#                     {"name": "病毒收获", "关键参数": ["病毒滴度", "收获时间"], "设备": ["连续流离心机"], "时间(h)": 4, "温度(℃)": "4"},
#                     {"name": "纯化", "关键参数": ["纯度", "回收率"], "设备": ["层析系统"], "时间(天)": 2, "温度(℃)": "4-8"},
#                     {"name": "灭活/减毒", "关键参数": ["灭活率", "免疫原性"], "设备": ["灭活罐"], "时间(h)": 24, "温度(℃)": "37"},
#                     {"name": "配制", "关键参数": ["抗原含量", "佐剂比例"], "设备": ["配制罐"], "时间(h)": 6, "温度(℃)": "2-8"},
#                     {"name": "无菌过滤", "关键参数": ["无菌保证"], "设备": ["除菌过滤器"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "灌装", "关键参数": ["灌装精度", "无菌操作"], "设备": ["隔离器灌装线"], "时间(h)": 8, "温度(℃)": "室温"},
#                     {"name": "冻干", "关键参数": ["水分", "外观"], "设备": ["冷冻干燥机"], "时间(天)": 3, "温度(℃)": "-40~25"},
#                     {"name": "包装", "关键参数": ["冷链管理"], "设备": ["自动包装线"], "时间(h)": 4, "温度(℃)": "2-8"}
#                 ]
#             },
            
#             "单克隆抗体": {
#                 "description": "由单一B细胞克隆产生的抗体",
#                 "关键特征": ["高特异性", "高纯度", "工艺复杂"],
#                 "工艺步骤": [
#                     {"name": "细胞库复苏", "关键参数": ["细胞活力", "无菌"], "设备": ["液氮罐"], "时间(天)": 3, "温度(℃)": "37"},
#                     {"name": "摇瓶培养", "关键参数": ["细胞密度", "活力"], "设备": ["摇床"], "时间(天)": 5, "温度(℃)": "37"},
#                     {"name": "生物反应器培养", "关键参数": ["DO", "pH", "细胞密度"], "设备": ["不锈钢生物反应器"], "时间(天)": 14, "温度(℃)": "37"},
#                     {"name": "收获", "关键参数": ["抗体浓度", "收获时间"], "设备": ["切向流过滤系统"], "时间(h)": 8, "温度(℃)": "4"},
#                     {"name": "Protein A亲和层析", "关键参数": ["结合容量", "洗脱条件"], "设备": ["AKTA层析系统"], "时间(天)": 2, "温度(℃)": "4-8"},
#                     {"name": "低pH病毒灭活", "关键参数": ["pH值", "灭活时间"], "设备": ["灭活罐"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "离子交换层析", "关键参数": ["纯度", "收率"], "设备": ["层析系统"], "时间(天)": 2, "温度(℃)": "4-8"},
#                     {"name": "超滤浓缩", "关键参数": ["浓度", "收率"], "设备": ["切向流超滤系统"], "时间(h)": 6, "温度(℃)": "4-8"},
#                     {"name": "无菌过滤", "关键参数": ["无菌保证"], "设备": ["除菌过滤器"], "时间(h)": 2, "温度(℃)": "室温"},
#                     {"name": "灌装", "关键参数": ["灌装精度"], "设备": ["西林瓶灌装线"], "时间(h)": 8, "温度(℃)": "室温"},
#                     {"name": "冻干", "关键参数": ["水分", "复溶性"], "设备": ["冷冻干燥机"], "时间(天)": 3, "温度(℃)": "-40~25"},
#                     {"name": "包装", "关键参数": ["密封完整性"], "设备": ["轧盖机"], "时间(h)": 4, "温度(℃)": "室温"}
#                 ]
#             }
#         },
        
#         # 5. 中药制剂
#         "中药制剂": {
#             "中药片剂": {
#                 "description": "中药提取物与辅料压制而成的片剂",
#                 "关键特征": ["携带方便", "剂量准确", "质量稳定"],
#                 "工艺步骤": [
#                     {"name": "药材前处理", "关键参数": ["净选", "切割规格"], "设备": ["洗药机", "切药机"], "时间(h)": 4, "温度(℃)": "室温"},
#                     {"name": "提取", "关键参数": ["溶剂", "温度", "时间"], "设备": ["多功能提取罐"], "时间(h)": 8, "温度(℃)": "80-90"},
#                     {"name": "浓缩", "关键参数": ["相对密度", "温度"], "设备": ["真空浓缩器"], "时间(h)": 6, "温度(℃)": "60-70"},
#                     {"name": "干燥", "关键参数": ["水分", "粒度"], "设备": ["喷雾干燥塔"], "时间(h)": 4, "温度(℃)": "80-100"},
#                     {"name": "粉碎过筛", "关键参数": ["粒度分布"], "设备": ["粉碎机", "振荡筛"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "制粒", "关键参数": ["颗粒性状", "水分"], "设备": ["湿法制粒机"], "时间(h)": 4, "温度(℃)": "室温"},
#                     {"name": "压片", "关键参数": ["片重差异", "硬度"], "设备": ["旋转压片机"], "时间(h)": 5, "温度(℃)": "室温"},
#                     {"name": "包衣", "关键参数": ["增重", "外观"], "设备": ["高效包衣锅"], "时间(h)": 6, "温度(℃)": "40-50"},
#                     {"name": "包装", "关键参数": ["密封防潮"], "设备": ["铝塑包装机"], "时间(h)": 3, "温度(℃)": "室温"}
#                 ]
#             }
#         },
        
#         # 6. 新型制剂
#         "新型制剂": {
#             "脂质体": {
#                 "description": "药物包封于类脂质双分子层中形成的微型泡囊",
#                 "关键特征": ["靶向性", "缓释性", "降低毒性"],
#                 "工艺步骤": [
#                     {"name": "脂质膜制备", "关键参数": ["磷脂比例", "成膜均匀性"], "设备": ["旋转蒸发仪"], "时间(h)": 3, "温度(℃)": "40-50"},
#                     {"name": "水化", "关键参数": ["温度", "水化时间"], "设备": ["水浴超声仪"], "时间(h)": 2, "温度(℃)": "50-60"},
#                     {"name": "载药", "关键参数": ["包封率", "载药量"], "设备": ["载药装置"], "时间(h)": 4, "温度(℃)": "50-60"},
#                     {"name": "挤出均质", "关键参数": ["压力", "循环次数", "粒径"], "设备": ["挤出器"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "纯化", "关键参数": ["分离效率"], "设备": ["柱层析系统"], "时间(h)": 6, "温度(℃)": "4-8"},
#                     {"name": "除菌过滤", "关键参数": ["无菌保证"], "设备": ["0.22μm滤器"], "时间(h)": 1, "温度(℃)": "室温"},
#                     {"name": "灌装", "关键参数": ["灌装精度"], "设备": ["灌装机"], "时间(h)": 3, "温度(℃)": "室温"},
#                     {"name": "冻干", "关键参数": ["冻干曲线", "复溶性"], "设备": ["冷冻干燥机"], "时间(天)": 2, "温度(℃)": "-40~25"},
#                     {"name": "包装", "关键参数": ["密封性"], "设备": ["轧盖机"], "时间(h)": 2, "温度(℃)": "室温"}
#                 ]
#             }
#         }
#     }
    
#     @staticmethod
#     def get_main_categories():
#         return list(PharmaceuticalProcesses.PROCESSES.keys())
    
#     @staticmethod
#     def get_products(main_category):
#         return list(PharmaceuticalProcesses.PROCESSES.get(main_category, {}).keys())
    
#     @staticmethod
#     def get_product_info(main_category, product):
#         return PharmaceuticalProcesses.PROCESSES.get(main_category, {}).get(product, {})

class PharmaceuticalProcesses:
    """制药工艺数据库 - 完整版"""
    
    PROCESSES = {
        # ===================== 化学药物 =====================
        "化学药物-固体制剂": {
            "片剂": {
                "description": "最常见的口服固体制剂，通过粉末压缩成型",
                "关键特征": ["剂量准确", "稳定性好", "便于服用", "适合大规模生产"],
                "工艺步骤": [
                    {"name": "原料验收", "关键参数": ["含量", "杂质", "粒度", "水分"], "设备": ["分析天平", "水分测定仪", "筛分机"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "称配", "关键参数": ["称量精度", "复核确认", "偏差控制"], "设备": ["精密电子天平", "配料系统"], "时间(h)": 1, "温度(℃)": "室温"},
                    {"name": "制粒", "关键参数": ["粘合剂浓度", "搅拌时间", "粒度分布", "终点判断"], "设备": ["高速剪切制粒机", "湿法制粒机"], "时间(h)": 3, "温度(℃)": "25-35"},
                    {"name": "干燥", "关键参数": ["进风温度", "出风温度", "水分含量", "干燥均匀性"], "设备": ["流化床干燥机", "烘箱"], "时间(h)": 4, "温度(℃)": "50-60"},
                    {"name": "整粒", "关键参数": ["筛网目数", "颗粒收率", "细粉率"], "设备": ["振荡整粒机", "旋转整粒机"], "时间(h)": 1, "温度(℃)": "室温"},
                    {"name": "总混", "关键参数": ["混合时间", "混合均匀度", "RSD值"], "设备": ["三维运动混合机", "V型混合机"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "压片", "关键参数": ["压片压力", "硬度", "片重差异", "崩解时限"], "设备": ["旋转压片机", "高速压片机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "包衣", "关键参数": ["包衣液浓度", "喷雾速率", "锅转速", "增重率"], "设备": ["高效包衣锅", "流化床包衣机"], "时间(h)": 6, "温度(℃)": "40-50"},
                    {"name": "内包装", "关键参数": ["泡罩成型", "热封温度", "密封性"], "设备": ["泡罩包装机", "铝塑包装机"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "外包装", "关键参数": ["装盒数量", "标签准确性", "批号打印"], "设备": ["自动装盒机", "贴标机"], "时间(h)": 2, "温度(℃)": "室温"}
                ]
            },
            
            "胶囊剂": {
                "description": "药物封装在明胶或植物胶囊中",
                "关键特征": ["掩盖不良味道", "提高生物利用度", "便于个性化", "稳定性好"],
                "工艺步骤": [
                    {"name": "原料处理", "关键参数": ["粒度分布", "流动性", "堆密度"], "设备": ["粉碎机", "气流粉碎机", "筛分机"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "称配混合", "关键参数": ["配比准确性", "混合均匀度", "水分控制"], "设备": ["电子台秤", "V型混合机"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "胶囊填充", "关键参数": ["装量差异", "锁合完整性", "生产速度"], "设备": ["全自动胶囊填充机", "半自动胶囊机"], "时间(h)": 5, "温度(℃)": "20-25"},
                    {"name": "胶囊抛光", "关键参数": ["外观光洁度", "粉尘去除率"], "设备": ["胶囊抛光机", "清洁刷"], "时间(h)": 1, "温度(℃)": "室温"},
                    {"name": "胶囊检查", "关键参数": ["外观缺陷", "重量差异", "锁合检查"], "设备": ["胶囊检查机", "人工灯检台"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "内包装", "关键参数": ["瓶装数量", "干燥剂添加", "封口严密性"], "设备": ["数粒装瓶机", "旋盖机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "外包装", "关键参数": ["标签信息", "批号效期", "装箱数量"], "设备": ["自动贴标机", "喷码机"], "时间(h)": 2, "温度(℃)": "室温"}
                ]
            },
            
            "颗粒剂": {
                "description": "药物与辅料制成的干燥颗粒状制剂",
                "关键特征": ["分散性好", "剂量准确", "便于儿童服用", "起效较快"],
                "工艺步骤": [
                    {"name": "原料前处理", "关键参数": ["粉碎细度", "水分含量", "微生物限度"], "设备": ["万能粉碎机", "振荡筛"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "配料称量", "关键参数": ["称量精度", "物料平衡"], "设备": ["电子台秤", "配料车"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "制粒", "关键参数": ["干法制粒压力", "粒度分布", "颗粒硬度"], "设备": ["干法制粒机", "摇摆制粒机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "干燥整粒", "关键参数": ["干燥终点水分", "颗粒均匀度"], "设备": ["沸腾干燥床", "整粒机"], "时间(h)": 5, "温度(℃)": "60-70"},
                    {"name": "总混", "关键参数": ["混合时间", "含量均匀度"], "设备": ["双锥混合机", "槽型混合机"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "分装", "关键参数": ["装量差异", "封口质量"], "设备": ["自动颗粒分装机", "袋包装机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "外包装", "关键参数": ["标签信息", "装箱规范"], "设备": ["自动装盒机", "热收缩包装机"], "时间(h)": 3, "温度(℃)": "室温"}
                ]
            },
            
            "散剂": {
                "description": "药物与适宜辅料经粉碎、均匀混合制成的干燥粉末状制剂",
                "关键特征": ["起效迅速", "剂量易调", "稳定性好", "生产成本低"],
                "工艺步骤": [
                    {"name": "原料粉碎", "关键参数": ["粉碎细度", "粒度分布"], "设备": ["气流粉碎机", "球磨机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "过筛混合", "关键参数": ["筛网目数", "混合均匀度"], "设备": ["旋振筛", "三维混合机"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "分剂量", "关键参数": ["装量差异", "包装速度"], "设备": ["自动粉剂分装机", "袋包装机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["密封性", "标签信息"], "设备": ["铝箔袋包装机", "装盒机"], "时间(h)": 4, "温度(℃)": "室温"}
                ]
            },
            
            "丸剂": {
                "description": "药物与适宜的辅料制成的球形或类球形制剂",
                "关键特征": ["剂量准确", "服用方便", "适合中药", "可包衣"],
                "工艺步骤": [
                    {"name": "药材处理", "关键参数": ["净制程度", "粉碎细度"], "设备": ["洗药机", "切药机", "粉碎机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "制丸", "关键参数": ["丸重差异", "圆整度", "硬度"], "设备": ["自动制丸机", "泛丸锅"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "干燥", "关键参数": ["干燥温度", "水分限度"], "设备": ["烘箱", "微波干燥机"], "时间(h)": 12, "温度(℃)": "60-80"},
                    {"name": "包衣", "关键参数": ["包衣增重", "溶散时限"], "设备": ["糖衣锅", "高效包衣机"], "时间(h)": 10, "温度(℃)": "40-50"},
                    {"name": "包装", "关键参数": ["密封防潮", "装量准确"], "设备": ["瓶装线", "袋包装机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            }
        },
        
        "化学药物-半固体制剂": {
            "软膏剂": {
                "description": "药物与油脂性或水溶性基质混合制成的半固体制剂",
                "关键特征": ["局部给药", "缓释作用", "保护创面", "使用方便"],
                "工艺步骤": [
                    {"name": "基质处理", "关键参数": ["熔融温度", "均一度", "无杂质"], "设备": ["夹层锅", "加热混合罐"], "时间(h)": 3, "温度(℃)": "70-80"},
                    {"name": "药物分散", "关键参数": ["分散细度", "均匀度", "无结块"], "设备": ["胶体磨", "均质机", "三辊研磨机"], "时间(h)": 4, "温度(℃)": "60-70"},
                    {"name": "乳化均质", "关键参数": ["乳化温度", "乳化时间", "pH值"], "设备": ["真空乳化罐", "高剪切乳化机"], "时间(h)": 5, "温度(℃)": "60-70"},
                    {"name": "脱气", "关键参数": ["真空度", "气泡残留"], "设备": ["真空脱气罐", "离心脱气机"], "时间(h)": 2, "温度(℃)": "50-60"},
                    {"name": "灌装", "关键参数": ["装量差异", "管尾密封性"], "设备": ["软膏灌装机", "铝管封尾机"], "时间(h)": 6, "温度(℃)": "40-50"},
                    {"name": "包装", "关键参数": ["装盒数量", "标签信息"], "设备": ["自动装盒机", "贴标机"], "时间(h)": 3, "温度(℃)": "室温"}
                ]
            },
            
            "凝胶剂": {
                "description": "药物与亲水性基质制成的透明或半透明半固体制剂",
                "关键特征": ["生物相容性好", "透皮吸收", "美观", "无油腻感"],
                "工艺步骤": [
                    {"name": "基质溶胀", "关键参数": ["溶胀时间", "溶胀温度", "粘度"], "设备": ["溶解罐", "搅拌机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "药物加入", "关键参数": ["溶解完全", "无结晶", "稳定性"], "设备": ["药物溶解罐", "过滤器"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "均质脱泡", "关键参数": ["均质压力", "气泡含量", "透明度"], "设备": ["真空均质机", "脱泡机"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["装量精度", "无气泡"], "设备": ["凝胶灌装机", "注射器灌装机"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["密封性", "标签清晰"], "设备": ["铝管封尾机", "装盒机"], "时间(h)": 3, "温度(℃)": "室温"}
                ]
            },
            
            "栓剂": {
                "description": "药物与适宜基质制成的供腔道给药的固体制剂",
                "关键特征": ["避免首过效应", "局部或全身作用", "起效较快"],
                "工艺步骤": [
                    {"name": "基质熔融", "关键参数": ["熔融温度", "熔融时间"], "设备": ["水浴锅", "夹层锅"], "时间(h)": 2, "温度(℃)": "50-60"},
                    {"name": "药物加入", "关键参数": ["分散均匀", "无沉降"], "设备": ["搅拌机", "均质机"], "时间(h)": 3, "温度(℃)": "50-60"},
                    {"name": "浇注", "关键参数": ["浇注温度", "浇注速度", "无气泡"], "设备": ["栓剂浇注机", "冷却系统"], "时间(h)": 4, "温度(℃)": "40-50"},
                    {"name": "冷却脱模", "关键参数": ["冷却温度", "冷却时间", "完整性"], "设备": ["冷却隧道", "脱模机"], "时间(h)": 3, "温度(℃)": "0-10"},
                    {"name": "包装", "关键参数": ["铝箔包装", "密封性"], "设备": ["泡罩包装机", "装盒机"], "时间(h)": 3, "温度(℃)": "室温"}
                ]
            },
            
            "乳膏剂": {
                "description": "药物溶解或分散于乳剂型基质中形成的半固体制剂",
                "关键特征": ["透皮性好", "外观洁白", "易于涂布", "稳定性好"],
                "工艺步骤": [
                    {"name": "油相制备", "关键参数": ["油相温度", "熔化完全"], "设备": ["油相罐", "加热器"], "时间(h)": 2, "温度(℃)": "75-85"},
                    {"name": "水相制备", "关键参数": ["水相温度", "溶解完全"], "设备": ["水相罐", "加热器"], "时间(h)": 2, "温度(℃)": "75-85"},
                    {"name": "乳化", "关键参数": ["乳化温度", "搅拌速度", "乳化时间"], "设备": ["真空乳化罐", "均质机"], "时间(h)": 4, "温度(℃)": "75-80"},
                    {"name": "冷却均质", "关键参数": ["冷却速率", "均质压力"], "设备": ["冷却搅拌罐", "均质机"], "时间(h)": 3, "温度(℃)": "40-50"},
                    {"name": "灌装", "关键参数": ["装量差异", "管体清洁"], "设备": ["乳膏灌装机", "封尾机"], "时间(h)": 5, "温度(℃)": "30-40"},
                    {"name": "包装", "关键参数": ["装盒规范", "标签准确"], "设备": ["自动装盒机", "喷码机"], "时间(h)": 3, "温度(℃)": "室温"}
                ]
            }
        },
        
        "化学药物-液体制剂": {
            "小容量注射剂": {
                "description": "供注入体内的无菌制剂，装量小于50ml",
                "关键特征": ["起效迅速", "生物利用度高", "无菌要求严格", "质量要求高"],
                "工艺步骤": [
                    {"name": "称量配料", "关键参数": ["称量精度", "环境洁净度"], "设备": ["电子天平", "层流称量罩"], "时间(h)": 3, "温度(℃)": "20-25"},
                    {"name": "配液过滤", "关键参数": ["溶解完全", "pH值", "澄明度", "除菌过滤"], "设备": ["配液罐", "除菌过滤器"], "时间(h)": 6, "温度(℃)": "20-25"},
                    {"name": "灌装封口", "关键参数": ["灌装精度", "密封性", "无菌操作"], "设备": ["安瓿灌封机", "西林瓶灌装线"], "时间(h)": 8, "温度(℃)": "20-25"},
                    {"name": "灭菌检漏", "关键参数": ["灭菌温度", "灭菌时间", "F0值", "检漏效果"], "设备": ["蒸汽灭菌柜", "色水检漏机"], "时间(h)": 4, "温度(℃)": "121"},
                    {"name": "灯检印字", "关键参数": ["可见异物", "印字清晰度"], "设备": ["自动灯检机", "安瓿印字机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["标签信息", "装箱数量"], "设备": ["贴标机", "装盒机"], "时间(h)": 4, "温度(℃)": "室温"}
                ]
            },
            
            "大容量注射剂": {
                "description": "供静脉滴注的无菌制剂，装量大于50ml",
                "关键特征": ["补充体液", "输送药物", "营养支持", "无菌无热原"],
                "工艺步骤": [
                    {"name": "水处理", "关键参数": ["电导率", "TOC", "微生物", "内毒素"], "设备": ["多效蒸馏水机", "纯化水系统"], "时间(h)": 24, "温度(℃)": "80-100"},
                    {"name": "称量配料", "关键参数": ["称量准确性", "物料平衡"], "设备": ["电子秤", "投料站"], "时间(h)": 4, "温度(℃)": "20-25"},
                    {"name": "配液过滤", "关键参数": ["溶解完全", "pH值", "含量均匀", "除热原"], "设备": ["浓配罐", "稀配罐", "超滤系统"], "时间(h)": 8, "温度(℃)": "20-25"},
                    {"name": "灌装压盖", "关键参数": ["灌装精度", "无泄漏", "压盖严密"], "设备": ["大输液灌装机", "翻塞压盖机"], "时间(h)": 10, "温度(℃)": "20-25"},
                    {"name": "灭菌", "关键参数": ["温度均匀性", "F0值", "冷却速度"], "设备": ["水浴灭菌柜", "旋转灭菌柜"], "时间(h)": 3, "温度(℃)": "121"},
                    {"name": "灯检包装", "关键参数": ["异物检查", "标签完整性"], "设备": ["大输液灯检机", "贴标机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "口服溶液剂": {
                "description": "药物溶解于适宜溶剂中制成的供口服的澄清液体制剂",
                "关键特征": ["吸收快", "剂量准确", "适合儿童老人", "服用方便"],
                "工艺步骤": [
                    {"name": "纯化水制备", "关键参数": ["电导率", "微生物限度"], "设备": ["反渗透系统", "多效蒸馏器"], "时间(h)": 24, "温度(℃)": "室温"},
                    {"name": "配料溶解", "关键参数": ["溶解完全", "无沉淀", "pH值"], "设备": ["配料罐", "搅拌器"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "过滤", "关键参数": ["滤材完整性", "澄明度"], "设备": ["板框过滤器", "微孔过滤器"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["装量差异", "密封性"], "设备": ["液体灌装机", "旋盖机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "灭菌", "关键参数": ["灭菌温度", "灭菌时间"], "设备": ["水浴灭菌柜", "流通蒸汽柜"], "时间(h)": 2, "温度(℃)": "100"},
                    {"name": "包装", "关键参数": ["标签信息", "装箱规范"], "设备": ["贴标机", "装盒机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            },
            
            "糖浆剂": {
                "description": "含有药物或芳香物质的浓蔗糖水溶液",
                "关键特征": ["掩盖苦味", "服用适口", "适合儿童", "稳定性好"],
                "工艺步骤": [
                    {"name": "糖浆制备", "关键参数": ["蔗糖浓度", "煮沸时间", "糖度"], "设备": ["化糖锅", "过滤器"], "时间(h)": 5, "温度(℃)": "100"},
                    {"name": "药物加入", "关键参数": ["溶解完全", "无沉淀"], "设备": ["混合罐", "搅拌器"], "时间(h)": 4, "温度(℃)": "60-70"},
                    {"name": "过滤", "关键参数": ["滤液澄清", "无杂质"], "设备": ["板框过滤器", "微孔滤器"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["装量准确", "瓶口清洁"], "设备": ["糖浆灌装机", "自动旋盖机"], "时间(h)": 7, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["标签位置", "装箱数量"], "设备": ["自动贴标机", "热收缩机"], "时间(h)": 4, "温度(℃)": "室温"}
                ]
            },
            
            "混悬剂": {
                "description": "难溶性固体药物分散在液体介质中形成的制剂",
                "关键特征": ["改善溶解度", "提高稳定性", "延长作用时间"],
                "工艺步骤": [
                    {"name": "药物微粉化", "关键参数": ["粒径分布", "比表面积"], "设备": ["气流粉碎机", "球磨机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "助悬剂制备", "关键参数": ["粘度", "溶胀完全"], "设备": ["溶胀罐", "搅拌器"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "分散混合", "关键参数": ["分散均匀", "无结块"], "设备": ["高剪切分散机", "均质机"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "均质", "关键参数": ["均质压力", "循环次数"], "设备": ["高压均质机", "胶体磨"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["灌装前混匀", "装量差异"], "设备": ["混悬剂灌装机", "旋盖机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["标签信息", "使用说明"], "设备": ["贴标机", "装盒机"], "时间(h)": 3, "温度(℃)": "室温"}
                ]
            }
        },
        
        "化学药物-气雾剂喷雾剂": {
            "定量吸入气雾剂(MDI)": {
                "description": "含抛射剂和药物的定量吸入制剂",
                "关键特征": ["肺部给药", "起效迅速", "剂量准确", "便携"],
                "工艺步骤": [
                    {"name": "药物微粉化", "关键参数": ["粒径范围", "分散性"], "设备": ["气流粉碎机", "喷雾干燥机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "处方配制", "关键参数": ["药物浓度", "抛射剂比例"], "设备": ["配制罐", "混合器"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["灌装精度", "无泄漏"], "设备": ["冷灌装机", "压力灌装机"], "时间(h)": 10, "温度(℃)": "-30~-40"},
                    {"name": "安装阀门", "关键参数": ["安装到位", "无泄漏"], "设备": ["阀门安装机", "封口机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "充抛射剂", "关键参数": ["充装压力", "充装量"], "设备": ["抛射剂充装机", "压力检测机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "检漏测试", "关键参数": ["泄漏率", "压力保持"], "设备": ["水浴检漏机", "压力测试仪"], "时间(h)": 4, "温度(℃)": "50-55"},
                    {"name": "包装", "关键参数": ["装盒完整", "标签信息"], "设备": ["自动装盒机", "说明书折叠机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            },
            
            "鼻用喷雾剂": {
                "description": "供鼻腔使用的定量喷雾制剂",
                "关键特征": ["鼻腔给药", "局部作用", "使用方便", "剂量准确"],
                "工艺步骤": [
                    {"name": "药液配制", "关键参数": ["药物浓度", "pH值", "渗透压"], "设备": ["配制罐", "过滤器"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "过滤除菌", "关键参数": ["滤器完整性", "无菌保证"], "设备": ["除菌过滤器", "无菌接收罐"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["灌装精度", "无污染"], "设备": ["无菌灌装机", "泵体安装机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "安装喷头", "关键参数": ["安装到位", "喷雾性能"], "设备": ["喷头安装机", "功能测试仪"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["密封包装", "使用说明"], "设备": ["泡罩包装机", "装盒机"], "时间(h)": 4, "温度(℃)": "室温"}
                ]
            }
        },
        
        # ===================== 生物制品 =====================
        "生物制品-疫苗类": {
            "灭活疫苗": {
                "description": "通过物理或化学方法使病原体失去活性但保留免疫原性的疫苗",
                "关键特征": ["安全性高", "稳定性好", "易于运输储存", "免疫程序简单"],
                "工艺步骤": [
                    {"name": "病毒/细菌培养", "关键参数": ["培养基配方", "培养温度", "pH值", "溶氧"], "设备": ["生物反应器", "摇床培养箱"], "时间(天)": 5, "温度(℃)": "35-37"},
                    {"name": "收获", "关键参数": ["收获时机", "收获体积", "滴度"], "设备": ["连续流离心机", "中空纤维系统"], "时间(h)": 8, "温度(℃)": "4-8"},
                    {"name": "灭活", "关键参数": ["灭活剂浓度", "灭活时间", "灭活温度"], "设备": ["灭活罐", "混合器"], "时间(h)": 48, "温度(℃)": "37"},
                    {"name": "纯化", "关键参数": ["纯度", "回收率", "内毒素"], "设备": ["超滤系统", "层析柱"], "时间(天)": 3, "温度(℃)": "4-8"},
                    {"name": "配制", "关键参数": ["抗原含量", "佐剂比例", "pH值"], "设备": ["配制罐", "混合器"], "时间(h)": 12, "温度(℃)": "2-8"},
                    {"name": "无菌过滤", "关键参数": ["过滤器完整性", "无菌保证"], "设备": ["除菌过滤器", "无菌罐"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["灌装精度", "无菌操作"], "设备": ["西林瓶灌装线", "预充针灌装机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["冷链管理", "批号追溯"], "设备": ["自动包装线", "冷链系统"], "时间(h)": 6, "温度(℃)": "2-8"}
                ]
            },
            
            "减毒活疫苗": {
                "description": "病原体经过处理毒性减弱但保持免疫原性的疫苗",
                "关键特征": ["免疫原性强", "持久免疫", "接种次数少", "冷链要求高"],
                "工艺步骤": [
                    {"name": "细胞培养", "关键参数": ["细胞代数", "细胞密度", "活力"], "设备": ["细胞工厂", "生物反应器"], "时间(天)": 7, "温度(℃)": "37"},
                    {"name": "病毒接种", "关键参数": ["MOI", "感染时间"], "设备": ["无菌操作台", "生物安全柜"], "时间(h)": 2, "温度(℃)": "37"},
                    {"name": "病毒培养", "关键参数": ["培养温度", "培养时间", "病毒滴度"], "设备": ["CO2培养箱", "生物反应器"], "时间(天)": 5, "温度(℃)": "37"},
                    {"name": "收获纯化", "关键参数": ["收获时机", "纯化收率", "杂质去除"], "设备": ["切向流过滤", "密度梯度离心"], "时间(天)": 3, "温度(℃)": "4-8"},
                    {"name": "配制", "关键参数": ["病毒滴度", "稳定剂浓度"], "设备": ["配制罐", "混合器"], "时间(h)": 8, "温度(℃)": "2-8"},
                    {"name": "冷冻干燥", "关键参数": ["冻干曲线", "水分含量", "活性保持"], "设备": ["冷冻干燥机", "西林瓶"], "时间(天)": 4, "温度(℃)": "-40~25"},
                    {"name": "包装", "关键参数": ["冷链运输", "温度监控"], "设备": ["自动包装线", "冷藏车"], "时间(h)": 6, "温度(℃)": "2-8"}
                ]
            },
            
            "重组蛋白疫苗": {
                "description": "利用基因工程技术表达病原体抗原蛋白制成的疫苗",
                "关键特征": ["安全性高", "成分明确", "易于质控", "规模化生产"],
                "工艺步骤": [
                    {"name": "基因工程构建", "关键参数": ["基因序列", "表达载体", "宿主选择"], "设备": ["PCR仪", "电转化仪"], "时间(天)": 7, "温度(℃)": "多种"},
                    {"name": "发酵表达", "关键参数": ["发酵密度", "诱导条件", "表达量"], "设备": ["发酵罐", "控制系统"], "时间(天)": 5, "温度(℃)": "30-37"},
                    {"name": "收获", "关键参数": ["收获时机", "细胞破碎效率"], "设备": ["离心机", "高压匀浆机"], "时间(h)": 12, "温度(℃)": "4-8"},
                    {"name": "纯化", "关键参数": ["层析条件", "纯度", "收率"], "设备": ["AKTA层析系统", "超滤系统"], "时间(天)": 4, "温度(℃)": "4-8"},
                    {"name": "灭活验证", "关键参数": ["核酸去除", "病毒灭活验证"], "设备": ["核酸检测仪", "验证系统"], "时间(天)": 3, "温度(℃)": "多种"},
                    {"name": "制剂", "关键参数": ["蛋白浓度", "佐剂吸附", "稳定性"], "设备": ["配制罐", "吸附系统"], "时间(h)": 24, "温度(℃)": "2-8"},
                    {"name": "灌装", "关键参数": ["无菌灌装", "剂量准确"], "设备": ["隔离器灌装线", "轧盖机"], "时间(h)": 12, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["标签信息", "冷链管理"], "设备": ["自动包装线", "冷藏库"], "时间(h)": 8, "温度(℃)": "2-8"}
                ]
            },
            
            "mRNA疫苗": {
                "description": "基于信使RNA技术的新型疫苗",
                "关键特征": ["研发周期短", "安全性高", "免疫应答强", "生产工艺新"],
                "工艺步骤": [
                    {"name": "质粒制备", "关键参数": ["质粒纯度", "拷贝数", "无内毒素"], "设备": ["发酵罐", "质粒提取系统"], "时间(天)": 5, "温度(℃)": "37"},
                    {"name": "体外转录", "关键参数": ["转录效率", "加帽率", "PolyA尾长度"], "设备": ["体外转录系统", "纯化设备"], "时间(h)": 24, "温度(℃)": "30-37"},
                    {"name": "mRNA纯化", "关键参数": ["纯度", "完整性", "无菌"], "设备": ["层析系统", "超滤系统"], "时间(天)": 2, "温度(℃)": "4-8"},
                    {"name": "脂质纳米粒制备", "关键参数": ["粒径分布", "包封率", "PDI"], "设备": ["微流控混合器", "挤出器"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "无菌过滤", "关键参数": ["无菌保证", "完整性测试"], "设备": ["除菌过滤器", "完整性测试仪"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["超低温灌装", "剂量准确"], "设备": ["超低温灌装线", "冻存系统"], "时间(h)": 10, "温度(℃)": "-70"},
                    {"name": "包装储运", "关键参数": ["超低温储运", "温度监测"], "设备": ["超低温冰箱", "干冰运输箱"], "时间(h)": 8, "温度(℃)": "-70"}
                ]
            }
        },
        
        "生物制品-血液制品": {
            "人血白蛋白": {
                "description": "从健康人血浆中分离提取的血浆蛋白制品",
                "关键特征": ["扩容作用", "运输功能", "稳定性好", "半衰期长"],
                "工艺步骤": [
                    {"name": "血浆融冻", "关键参数": ["融冻温度", "融冻时间", "无蛋白变性"], "设备": ["血浆融冻机", "水浴系统"], "时间(h)": 12, "温度(℃)": "0-4"},
                    {"name": "低温乙醇分离", "关键参数": ["乙醇浓度", "pH值", "温度", "离子强度"], "设备": ["低温冷库", "反应罐"], "时间(h)": 24, "温度(℃)": "-5~-3"},
                    {"name": "离心分离", "关键参数": ["离心速度", "分离时间", "收率"], "设备": ["连续流离心机", "压滤机"], "时间(h)": 8, "温度(℃)": "0-4"},
                    {"name": "超滤浓缩", "关键参数": ["膜孔径", "浓缩倍数", "收率"], "设备": ["中空纤维超滤", "卷式超滤"], "时间(h)": 12, "温度(℃)": "2-8"},
                    {"name": "巴氏消毒", "关键参数": ["加热温度", "保持时间", "病毒灭活"], "设备": ["巴氏消毒柜", "水浴系统"], "时间(h)": 10, "温度(℃)": "60"},
                    {"name": "除菌过滤", "关键参数": ["过滤器完整性", "无菌保证"], "设备": ["除菌过滤器", "完整性测试仪"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["灌装精度", "无热原"], "设备": ["血液制品灌装线", "压塞机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["标签信息", "储存条件"], "设备": ["贴标机", "装盒机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "静脉注射人免疫球蛋白(pH4)": {
                "description": "从健康人血浆中分离制备的免疫球蛋白制剂",
                "关键特征": ["免疫调节", "抗感染", "多种抗体", "治疗免疫缺陷"],
                "工艺步骤": [
                    {"name": "血浆预处理", "关键参数": ["血浆质量", "融冻条件"], "设备": ["血浆融冻机", "储罐"], "时间(h)": 12, "温度(℃)": "0-4"},
                    {"name": "冷乙醇分离", "关键参数": ["乙醇梯度", "pH控制", "温度控制"], "设备": ["低温反应罐", "pH控制系统"], "时间(天)": 3, "温度(℃)": "-5~-3"},
                    {"name": "层析纯化", "关键参数": ["柱效", "洗脱条件", "纯度"], "设备": ["层析系统", "在线监测"], "时间(天)": 2, "温度(℃)": "4-8"},
                    {"name": "病毒灭活去除", "关键参数": ["低pH孵育", "纳米过滤", "S/D处理"], "设备": ["病毒灭活罐", "纳米过滤器"], "时间(天)": 2, "温度(℃)": "24-37"},
                    {"name": "超滤透析", "关键参数": ["pH调整", "电导率", "蛋白浓度"], "设备": ["切向流超滤", "透析系统"], "时间(h)": 24, "温度(℃)": "4-8"},
                    {"name": "配制除菌", "关键参数": ["IgG浓度", "稳定剂", "无菌过滤"], "设备": ["配制罐", "除菌过滤系统"], "时间(h)": 12, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["无菌灌装", "无热原"], "设备": ["西林瓶灌装线", "冻干机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["冷链管理", "批号追溯"], "设备": ["自动包装线", "冷藏系统"], "时间(h)": 8, "温度(℃)": "2-8"}
                ]
            },
            
            "人凝血因子VIII": {
                "description": "治疗血友病A的凝血因子制剂",
                "关键特征": ["治疗血友病", "止血功能", "纯度高", "安全性好"],
                "工艺步骤": [
                    {"name": "血浆分离", "关键参数": ["血浆来源", "分离条件"], "设备": ["血浆分离机", "冷沉淀系统"], "时间(h)": 8, "温度(℃)": "0-4"},
                    {"name": "冷沉淀制备", "关键参数": ["沉淀温度", "沉淀时间", "收获率"], "设备": ["冷沉淀制备系统", "离心机"], "时间(h)": 24, "温度(℃)": "0-4"},
                    {"name": "溶解提取", "关键参数": ["溶解条件", "提取效率"], "设备": ["溶解罐", "提取系统"], "时间(h)": 6, "温度(℃)": "4-8"},
                    {"name": "层析纯化", "关键参数": ["亲和层析", "离子交换", "纯度"], "设备": ["AKTA层析系统", "层析柱"], "时间(天)": 2, "温度(℃)": "4-8"},
                    {"name": "病毒灭活", "关键参数": ["S/D处理", "干热灭活", "验证效果"], "设备": ["病毒灭活罐", "干热烤箱"], "时间(h)": 24, "温度(℃)": "60-80"},
                    {"name": "超滤配制", "关键参数": ["蛋白浓度", "稳定剂", "活性保持"], "设备": ["超滤系统", "配制罐"], "时间(h)": 12, "温度(℃)": "4-8"},
                    {"name": "无菌灌装", "关键参数": ["灌装精度", "无菌操作"], "设备": ["隔离器灌装线", "冻干机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "包装储运", "关键参数": ["冷链要求", "稳定性"], "设备": ["冷藏包装线", "温度记录仪"], "时间(h)": 6, "温度(℃)": "2-8"}
                ]
            },
            
            "人纤维蛋白原": {
                "description": "从血浆中提取的纤维蛋白原制剂",
                "关键特征": ["止血作用", "组织修复", "外科应用", "凝血功能"],
                "工艺步骤": [
                    {"name": "血浆预处理", "关键参数": ["血浆质量", "预处理条件"], "设备": ["血浆处理系统", "过滤器"], "时间(h)": 6, "温度(℃)": "0-4"},
                    {"name": "冷沉淀分离", "关键参数": ["沉淀条件", "分离效率"], "设备": ["冷沉淀系统", "离心机"], "时间(h)": 24, "温度(℃)": "0-4"},
                    {"name": "溶解提取", "关键参数": ["溶解液组成", "提取时间"], "设备": ["溶解罐", "搅拌系统"], "时间(h)": 8, "温度(℃)": "4-8"},
                    {"name": "纯化", "关键参数": ["沉淀纯化", "层析纯化", "纯度"], "设备": ["沉淀罐", "层析系统"], "时间(天)": 2, "温度(℃)": "4-8"},
                    {"name": "病毒灭活", "关键参数": ["灭活方法", "灭活效果验证"], "设备": ["病毒灭活系统", "验证设备"], "时间(h)": 24, "温度(℃)": "多种"},
                    {"name": "配制冻干", "关键参数": ["蛋白浓度", "稳定剂", "冻干曲线"], "设备": ["配制罐", "冷冻干燥机"], "时间(天)": 3, "温度(℃)": "-40~25"},
                    {"name": "轧盖包装", "关键参数": ["密封性", "标签信息"], "设备": ["轧盖机", "贴标机"], "时间(h)": 8, "温度(℃)": "室温"}
                ]
            }
        },
        
        "生物制品-单抗与重组蛋白": {
            "单克隆抗体": {
                "description": "由单一B细胞克隆产生的特异性抗体",
                "关键特征": ["高特异性", "高纯度", "治疗多种疾病", "工艺复杂"],
                "工艺步骤": [
                    {"name": "细胞库复苏", "关键参数": ["细胞活力", "无菌检测", "支原体"], "设备": ["液氮罐", "CO2培养箱"], "时间(天)": 3, "温度(℃)": "37"},
                    {"name": "摇瓶培养", "关键参数": ["细胞密度", "活力", "代谢参数"], "设备": ["摇床", "生物反应器"], "时间(天)": 5, "温度(℃)": "37"},
                    {"name": "生物反应器培养", "关键参数": ["DO控制", "pH控制", "细胞密度", "抗体滴度"], "设备": ["不锈钢生物反应器", "控制系统"], "时间(天)": 14, "温度(℃)": "37"},
                    {"name": "收获澄清", "关键参数": ["收获时机", "澄清度", "收获收率"], "设备": ["切向流过滤系统", "深层过滤器"], "时间(h)": 8, "温度(℃)": "4"},
                    {"name": "Protein A亲和层析", "关键参数": ["结合载量", "洗脱pH", "回收率"], "设备": ["AKTA层析系统", "层析柱"], "时间(天)": 2, "温度(℃)": "4-8"},
                    {"name": "低pH病毒灭活", "关键参数": ["pH值", "灭活时间", "温度"], "设备": ["灭活罐", "pH调节系统"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "离子交换层析", "关键参数": ["结合条件", "洗脱条件", "纯度"], "设备": ["层析系统", "在线监测"], "时间(天)": 2, "温度(℃)": "4-8"},
                    {"name": "超滤浓缩", "关键参数": ["浓缩倍数", "缓冲液置换", "收率"], "设备": ["切向流超滤系统", "渗滤系统"], "时间(h)": 6, "温度(℃)": "4-8"},
                    {"name": "无菌过滤", "关键参数": ["无菌保证", "完整性测试"], "设备": ["除菌过滤器", "完整性测试仪"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "灌装冻干", "关键参数": ["灌装精度", "冻干曲线", "水分"], "设备": ["西林瓶灌装线", "冷冻干燥机"], "时间(天)": 3, "温度(℃)": "-40~25"},
                    {"name": "包装", "关键参数": ["标签信息", "储存条件"], "设备": ["轧盖机", "贴标机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "融合蛋白": {
                "description": "通过基因工程将不同蛋白功能域融合表达的蛋白质",
                "关键特征": ["多功能性", "稳定性好", "半衰期长", "治疗作用明确"],
                "工艺步骤": [
                    {"name": "细胞系构建", "关键参数": ["基因序列", "表达载体", "筛选标记"], "设备": ["分子生物学设备", "细胞培养箱"], "时间(周)": 4, "温度(℃)": "多种"},
                    {"name": "细胞培养", "关键参数": ["细胞生长", "蛋白表达", "代谢控制"], "设备": ["生物反应器", "过程分析"], "时间(天)": 12, "温度(℃)": "37"},
                    {"name": "收获", "关键参数": ["收获条件", "细胞分离", "上清收集"], "设备": ["离心机", "深层过滤"], "时间(h)": 8, "温度(℃)": "4-8"},
                    {"name": "捕获层析", "关键参数": ["亲和层析", "洗脱条件", "初步纯化"], "设备": ["层析系统", "收集器"], "时间(天)": 2, "温度(℃)": "4-8"},
                    {"name": "精细纯化", "关键参数": ["离子交换", "疏水层析", "分子筛"], "设备": ["多柱层析系统", "在线检测"], "时间(天)": 3, "温度(℃)": "4-8"},
                    {"name": "病毒去除", "关键参数": ["纳米过滤", "低pH孵育", "验证"], "设备": ["病毒过滤器", "灭活系统"], "时间(h)": 24, "温度(℃)": "多种"},
                    {"name": "超滤配制", "关键参数": ["蛋白浓度", "制剂配方", "稳定性"], "设备": ["超滤系统", "配制罐"], "时间(h)": 12, "温度(℃)": "4-8"},
                    {"name": "灌装", "关键参数": ["无菌操作", "灌装精度"], "设备": ["灌装线", "冻干机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["质量检验", "包装规范"], "设备": ["贴标机", "装盒机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "酶类药物": {
                "description": "具有特定酶活性的治疗性蛋白质",
                "关键特征": ["催化作用", "底物特异性", "治疗酶缺陷", "稳定性要求高"],
                "工艺步骤": [
                    {"name": "发酵生产", "关键参数": ["菌株/细胞", "发酵条件", "表达水平"], "设备": ["发酵罐", "控制系统"], "时间(天)": 7, "温度(℃)": "30-37"},
                    {"name": "细胞破碎", "关键参数": ["破碎效率", "酶活保持", "温度控制"], "设备": ["高压匀浆机", "超声破碎仪"], "时间(h)": 6, "温度(℃)": "4-8"},
                    {"name": "粗纯", "关键参数": ["沉淀条件", "离心分离", "初步纯化"], "设备": ["沉淀罐", "离心机"], "时间(h)": 12, "温度(℃)": "4-8"},
                    {"name": "精纯", "关键参数": ["层析条件", "酶活回收", "纯度"], "设备": ["层析系统", "活性检测"], "时间(天)": 3, "温度(℃)": "4-8"},
                    {"name": "病毒灭活", "关键参数": ["灭活方法", "酶活影响", "验证"], "设备": ["病毒灭活设备", "活性测试"], "时间(h)": 24, "温度(℃)": "多种"},
                    {"name": "超滤浓缩", "关键参数": ["浓缩条件", "缓冲液置换", "酶活保持"], "设备": ["超滤系统", "渗滤装置"], "时间(h)": 8, "温度(℃)": "4-8"},
                    {"name": "制剂", "关键参数": ["稳定剂", "pH值", "酶活性"], "设备": ["配制罐", "混合系统"], "时间(h)": 6, "温度(℃)": "4-8"},
                    {"name": "灌装冻干", "关键参数": ["冻干保护剂", "冻干程序", "复溶性"], "设备": ["灌装机", "冻干机"], "时间(天)": 4, "温度(℃)": "-40~25"}
                ]
            }
        },
        
        "生物制品-细胞与基因治疗": {
            "CAR-T细胞": {
                "description": "经基因改造表达嵌合抗原受体的T细胞疗法",
                "关键特征": ["个体化治疗", "靶向性强", "治疗血液肿瘤", "技术前沿"],
                "工艺步骤": [
                    {"name": "患者白细胞采集", "关键参数": ["采集量", "细胞活力", "无菌"], "设备": ["血细胞分离机", "采集袋"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "T细胞分离激活", "关键参数": ["分离纯度", "激活效率", "细胞状态"], "设备": ["磁珠分选系统", "激活培养袋"], "时间(天)": 2, "温度(℃)": "37"},
                    {"name": "基因转导", "关键参数": ["转导效率", "病毒滴度", "MOI"], "设备": ["生物安全柜", "培养系统"], "时间(天)": 1, "温度(℃)": "37"},
                    {"name": "细胞扩增", "关键参数": ["扩增倍数", "细胞表型", "功能检测"], "设备": ["生物反应器", "培养袋系统"], "时间(天)": 10, "温度(℃)": "37"},
                    {"name": "细胞收获洗涤", "关键参数": ["收获时机", "洗涤次数", "最终体积"], "设备": ["细胞收获器", "洗涤系统"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "制剂配制", "关键参数": ["细胞浓度", "制剂配方", "稳定性"], "设备": ["配制系统", "混合袋"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "灌装冻存", "关键参数": ["灌装精度", "冻存程序", "细胞活力"], "设备": ["细胞灌装机", "程序降温仪"], "时间(h)": 6, "温度(℃)": "4~-196"},
                    {"name": "放行检验", "关键参数": ["无菌", "支原体", "效力", "纯度"], "设备": ["流式细胞仪", "PCR仪"], "时间(天)": 7, "温度(℃)": "多种"},
                    {"name": "冷链运输", "关键参数": ["温度监控", "运输时间", "交接确认"], "设备": ["液氮罐", "温度记录仪"], "时间(天)": 1, "温度(℃)": "-150以下"}
                ]
            },
            
            "基因治疗载体": {
                "description": "用于递送治疗基因的病毒或非病毒载体",
                "关键特征": ["基因递送", "治疗遗传病", "技术复杂", "监管严格"],
                "工艺步骤": [
                    {"name": "载体构建", "关键参数": ["基因序列", "载体类型", "启动子"], "设备": ["分子克隆设备", "测序仪"], "时间(周)": 3, "温度(℃)": "多种"},
                    {"name": "细胞培养", "关键参数": ["细胞系", "培养条件", "规模"], "设备": ["细胞工厂", "生物反应器"], "时间(天)": 7, "温度(℃)": "37"},
                    {"name": "病毒包装", "关键参数": ["转染效率", "包装细胞", "条件优化"], "设备": ["转染设备", "培养系统"], "时间(天)": 5, "温度(℃)": "37"},
                    {"name": "收获澄清", "关键参数": ["收获方法", "澄清度", "收率"], "设备": ["收获系统", "澄清过滤器"], "时间(h)": 12, "温度(℃)": "4-8"},
                    {"name": "纯化", "关键参数": ["层析方法", "纯度", "滴度"], "设备": ["层析系统", "超滤系统"], "时间(天)": 3, "温度(℃)": "4-8"},
                    {"name": "无菌过滤", "关键参数": ["无菌保证", "完整性测试", "滴度损失"], "设备": ["除菌过滤器", "完整性测试仪"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "灌装冻存", "关键参数": ["灌装精度", "冻存保护剂", "稳定性"], "设备": ["灌装线", "程序降温仪"], "时间(h)": 8, "温度(℃)": "4~-80"},
                    {"name": "质量检测", "关键参数": ["滴度测定", "无菌检测", "效力检测"], "设备": ["滴度检测设备", "QC实验室"], "时间(天)": 10, "温度(℃)": "多种"},
                    {"name": "储存运输", "关键参数": ["储存温度", "稳定性", "运输验证"], "设备": ["超低温冰箱", "冷链系统"], "时间(年)": 2, "温度(℃)": "-80以下"}
                ]
            }
        },
        
        # ===================== 中药制剂 =====================
        "中药制剂-传统剂型": {
            "蜜丸": {
                "description": "药材细粉以蜂蜜为粘合剂制成的丸剂",
                "关键特征": ["缓释作用", "口感较好", "适合滋补药", "传统工艺"],
                "工艺步骤": [
                    {"name": "药材炮制", "关键参数": ["炮制程度", "水分含量"], "设备": ["炒药机", "蒸煮锅"], "时间(h)": 8, "温度(℃)": "多种"},
                    {"name": "粉碎过筛", "关键参数": ["粉碎细度", "筛网目数"], "设备": ["粉碎机", "振荡筛"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "炼蜜", "关键参数": ["蜂蜜质量", "炼蜜程度", "含水量"], "设备": ["炼蜜锅", "温度计"], "时间(h)": 4, "温度(℃)": "105-115"},
                    {"name": "合坨", "关键参数": ["蜜药比例", "混合均匀度", "软硬度"], "设备": ["混合机", "捏合机"], "时间(h)": 3, "温度(℃)": "60-70"},
                    {"name": "制丸", "关键参数": ["丸重差异", "圆整度"], "设备": ["制丸机", "搓丸板"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "干燥", "关键参数": ["干燥温度", "干燥时间", "水分"], "设备": ["烘箱", "干燥室"], "时间(h)": 24, "温度(℃)": "60-80"},
                    {"name": "包装", "关键参数": ["蜡壳包装", "密封性"], "设备": ["蜡壳机", "封装机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "水丸": {
                "description": "药材细粉以水或水性液体为粘合剂制成的丸剂",
                "关键特征": ["溶散较快", "便于服用", "适合多种药物", "成本较低"],
                "工艺步骤": [
                    {"name": "药材处理", "关键参数": ["粉碎细度", "过筛"], "设备": ["粉碎机", "筛粉机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "起模", "关键参数": ["模子大小", "均匀度"], "设备": ["泛丸锅", "喷雾器"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "成型", "关键参数": ["丸粒增大", "圆整度", "丸重"], "设备": ["泛丸锅", "加粉机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "盖面", "关键参数": ["表面光洁", "色泽均匀"], "设备": ["泛丸锅", "抛光机"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "干燥", "关键参数": ["干燥温度", "时间", "水分"], "设备": ["烘箱", "干燥机"], "时间(h)": 12, "温度(℃)": "60-80"},
                    {"name": "选丸", "关键参数": ["粒径均一", "剔除畸形"], "设备": ["选丸机", "筛丸机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["瓶装或袋装", "密封性"], "设备": ["装瓶机", "封口机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            },
            
            "散剂(中药)": {
                "description": "一种或多种药材经粉碎、混合制成的粉末状制剂",
                "关键特征": ["起效迅速", "剂量可调", "服用方便", "适合外用"],
                "工艺步骤": [
                    {"name": "药材净选", "关键参数": ["净度", "无杂质"], "设备": ["挑选台", "洗药机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "干燥", "关键参数": ["干燥程度", "水分限度"], "设备": ["烘箱", "干燥机"], "时间(h)": 8, "温度(℃)": "60-80"},
                    {"name": "粉碎", "关键参数": ["粉碎细度", "粒度分布"], "设备": ["万能粉碎机", "超微粉碎机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "过筛", "关键参数": ["筛网目数", "过筛效率"], "设备": ["旋振筛", "振荡筛"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "混合", "关键参数": ["混合均匀度", "色泽一致"], "设备": ["三维混合机", "V型混合机"], "time(h)": 5, "温度(℃)": "室温"},
                    {"name": "分装", "关键参数": ["装量差异", "包装材料"], "设备": ["散剂分装机", "袋包装机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["标签信息", "使用说明"], "设备": ["贴标机", "装盒机"], "时间(h)": 4, "温度(℃)": "室温"}
                ]
            },
            
            "膏药(黑膏药)": {
                "description": "药材、食用植物油与红丹炼制而成的外用膏剂",
                "关键特征": ["经皮吸收", "作用持久", "传统外用", "使用方便"],
                "工艺步骤": [
                    {"name": "药材提取", "关键参数": ["提取时间", "提取温度", "提取次数"], "设备": ["提取罐", "浓缩器"], "时间(h)": 12, "温度(℃)": "80-100"},
                    {"name": "炼油", "关键参数": ["炼油温度", "炼油程度", "滴水成珠"], "设备": ["炼油锅", "温度计"], "时间(h)": 8, "温度(℃)": "300-320"},
                    {"name": "下丹", "关键参数": ["丹油比例", "下丹温度", "反应程度"], "设备": ["下丹锅", "搅拌器"], "时间(h)": 2, "温度(℃)": "270-300"},
                    {"name": "去火毒", "关键参数": ["浸泡时间", "换水次数"], "设备": ["浸泡池", "流动水"], "时间(天)": 7, "温度(℃)": "室温"},
                    {"name": "摊涂", "关键参数": ["膏体重量", "摊涂均匀", "厚薄一致"], "设备": ["摊涂机", "膏药布"], "时间(h)": 6, "温度(℃)": "70-80"},
                    {"name": "包装", "关键参数": ["防粘材料", "使用说明"], "设备": ["包装机", "装盒机"], "时间(h)": 4, "温度(℃)": "室温"}
                ]
            }
        },
        
        "中药制剂-现代剂型": {
            "中药注射剂": {
                "description": "药材经提取纯化后制成的供注入体内的灭菌制剂",
                "关键特征": ["起效迅速", "生物利用度高", "质量要求严", "工艺复杂"],
                "工艺步骤": [
                    {"name": "药材前处理", "关键参数": ["净选程度", "切割规格", "清洗效果"], "设备": ["洗药机", "切药机", "干燥机"], "时间(h)": 8, "温度(℃)": "多种"},
                    {"name": "提取", "关键参数": ["溶剂选择", "提取温度", "提取时间", "提取次数"], "设备": ["多功能提取罐", "动态提取罐"], "时间(h)": 12, "温度(℃)": "80-100"},
                    {"name": "浓缩", "关键参数": ["浓缩温度", "真空度", "相对密度"], "设备": ["真空浓缩器", "薄膜蒸发器"], "时间(h)": 10, "温度(℃)": "60-70"},
                    {"name": "醇沉", "关键参数": ["乙醇浓度", "加醇速度", "沉淀时间"], "设备": ["醇沉罐", "搅拌系统"], "时间(h)": 24, "温度(℃)": "室温"},
                    {"name": "水沉", "关键参数": ["加水量", "沉淀时间", "温度"], "设备": ["水沉罐", "过滤器"], "时间(h)": 12, "温度(℃)": "室温"},
                    {"name": "精制", "关键参数": ["柱层析", "膜分离", "纯度"], "设备": ["层析系统", "超滤系统"], "时间(天)": 3, "温度(℃)": "室温"},
                    {"name": "配液", "关键参数": ["药液浓度", "pH值", "澄明度"], "设备": ["配液罐", "过滤器"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "灌封灭菌", "关键参数": ["灌装精度", "密封性", "F0值"], "设备": ["安瓿灌封机", "灭菌柜"], "时间(h)": 10, "温度(℃)": "121"},
                    {"name": "灯检包装", "关键参数": ["可见异物", "印字清晰", "包装完整"], "设备": ["灯检机", "印字机", "装盒机"], "时间(h)": 8, "温度(℃)": "室温"}
                ]
            },
            
            "中药颗粒剂": {
                "description": "药材提取物与适宜辅料制成的干燥颗粒状制剂",
                "关键特征": ["携带方便", "剂量准确", "服用方便", "质量稳定"],
                "工艺步骤": [
                    {"name": "药材提取", "关键参数": ["提取方法", "提取效率", "有效成分"], "设备": ["提取罐", "浓缩器"], "时间(h)": 10, "温度(℃)": "80-100"},
                    {"name": "浓缩", "关键参数": ["浓缩程度", "相对密度", "温度控制"], "设备": ["真空浓缩器", "薄膜蒸发器"], "时间(h)": 8, "温度(℃)": "60-70"},
                    {"name": "干燥", "关键参数": ["干燥方法", "水分控制", "成分保留"], "设备": ["喷雾干燥塔", "真空干燥箱"], "时间(h)": 6, "温度(℃)": "80-100"},
                    {"name": "制粒", "关键参数": ["辅料比例", "颗粒粒度", "流动性"], "设备": ["湿法制粒机", "流化床制粒机"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "干燥整粒", "关键参数": ["干燥温度", "水分限度", "粒度分布"], "设备": ["沸腾干燥床", "整粒机"], "时间(h)": 6, "温度(℃)": "60-70"},
                    {"name": "总混", "关键参数": ["混合均匀度", "含量一致"], "设备": ["三维混合机", "双锥混合机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "分装", "关键参数": ["装量差异", "包装材料", "密封性"], "设备": ["颗粒分装机", "袋包装机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["标签信息", "装箱规范"], "设备": ["装盒机", "热收缩机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            },
            
            "中药胶囊": {
                "description": "药材提取物或药材粉末与适宜辅料填充于胶囊壳中",
                "关键特征": ["掩盖不良气味", "提高稳定性", "服用方便", "生物利用度较好"],
                "工艺步骤": [
                    {"name": "药材处理", "关键参数": ["粉碎细度", "提取效率"], "设备": ["粉碎机", "提取设备"], "时间(h)": 10, "温度(℃)": "多种"},
                    {"name": "提取物制备", "关键参数": ["干燥方法", "粉末性质"], "设备": ["喷雾干燥", "真空干燥"], "时间(h)": 8, "温度(℃)": "60-80"},
                    {"name": "混合", "关键参数": ["辅料选择", "混合均匀度"], "设备": ["混合机", "过筛机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "胶囊填充", "关键参数": ["装量差异", "胶囊锁合"], "设备": ["胶囊填充机", "胶囊抛光机"], "时间(h)": 10, "温度(℃)": "20-25"},
                    {"name": "抛光检查", "关键参数": ["外观质量", "重量差异"], "设备": ["胶囊抛光机", "检查机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["瓶装或板装", "密封防潮"], "设备": ["装瓶机", "铝塑包装机"], "时间(h)": 8, "温度(℃)": "室温"}
                ]
            },
            
            "中药口服液": {
                "description": "药材用水或其他溶剂提取制成的口服液体制剂",
                "关键特征": ["吸收较快", "剂量准确", "适合儿童", "口感较好"],
                "工艺步骤": [
                    {"name": "药材提取", "关键参数": ["提取条件", "提取次数", "出膏率"], "设备": ["提取罐", "过滤机"], "时间(h)": 12, "温度(℃)": "80-100"},
                    {"name": "浓缩", "关键参数": ["浓缩温度", "浓缩程度", "相对密度"], "设备": ["真空浓缩器", "薄膜蒸发器"], "时间(h)": 10, "温度(℃)": "60-70"},
                    {"name": "配制", "关键参数": ["糖度", "pH值", "澄明度"], "设备": ["配液罐", "过滤器"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["装量差异", "密封性"], "设备": ["口服液灌装机", "扎盖机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "灭菌", "关键参数": ["灭菌温度", "灭菌时间"], "设备": ["灭菌柜", "水浴灭菌"], "时间(h)": 2, "温度(℃)": "100"},
                    {"name": "包装", "关键参数": ["标签信息", "装盒数量"], "设备": ["贴标机", "装盒机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            }
        },
        
        # ===================== 新型制剂 =====================
        "新型制剂-靶向制剂": {
            "脂质体": {
                "description": "药物包封于类脂质双分子层中形成的微型泡囊",
                "关键特征": ["靶向性", "缓释性", "降低毒性", "提高稳定性"],
                "工艺步骤": [
                    {"name": "脂质膜制备", "关键参数": ["磷脂组成", "成膜均匀性", "溶剂残留"], "设备": ["旋转蒸发仪", "薄膜分散装置"], "时间(h)": 4, "温度(℃)": "40-50"},
                    {"name": "水化", "关键参数": ["水化温度", "水化时间", "缓冲液组成"], "设备": ["水浴摇床", "水化装置"], "时间(h)": 3, "温度(℃)": "50-60"},
                    {"name": "载药", "关键参数": ["载药方法", "包封率", "载药量"], "设备": ["载药装置", "孵育系统"], "时间(h)": 6, "温度(℃)": "50-60"},
                    {"name": "粒径控制", "关键参数": ["挤出压力", "循环次数", "粒径分布"], "设备": ["挤出器", "高压均质机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "纯化", "关键参数": ["分离方法", "游离药物去除", "收率"], "设备": ["柱层析系统", "超滤系统"], "时间(h)": 8, "温度(℃)": "4-8"},
                    {"name": "无菌过滤", "关键参数": ["无菌保证", "完整性测试"], "设备": ["除菌过滤器", "完整性测试仪"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "灌装冻干", "关键参数": ["冻干保护剂", "冻干曲线", "复溶性"], "设备": ["灌装机", "冷冻干燥机"], "时间(天)": 3, "温度(℃)": "-40~25"},
                    {"name": "包装", "关键参数": ["避光包装", "储存条件"], "设备": ["轧盖机", "贴标机"], "时间(h)": 4, "温度(℃)": "室温"}
                ]
            },
            
            "微球": {
                "description": "药物分散或被吸附在高分子聚合物基质中形成的微小球状实体",
                "关键特征": ["缓释长效", "靶向性", "稳定性好", "减少给药次数"],
                "工艺步骤": [
                    {"name": "聚合物处理", "关键参数": ["聚合物分子量", "溶解性", "浓度"], "设备": ["溶解罐", "过滤器"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "药物分散", "关键参数": ["药物状态", "分散均匀性"], "设备": ["分散机", "均质机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "乳化", "关键参数": ["乳化剂选择", "乳化速度", "乳液稳定性"], "设备": ["乳化机", "高速搅拌"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "固化", "关键参数": ["固化方法", "固化时间", "固化程度"], "设备": ["固化装置", "搅拌系统"], "时间(h)": 12, "温度(℃)": "室温"},
                    {"name": "分离洗涤", "关键参数": ["分离效率", "洗涤次数", "溶剂残留"], "设备": ["离心机", "洗涤系统"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "冷冻干燥", "关键参数": ["冻干保护剂", "冻干程序", "水分"], "设备": ["冻干机", "程序控制"], "时间(天)": 3, "温度(℃)": "-40~25"},
                    {"name": "筛分", "关键参数": ["粒径分布", "筛分效率"], "设备": ["振动筛", "空气喷射筛"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["无菌分装", "储存条件"], "设备": ["分装机", "封口机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            },
            
            "纳米粒": {
                "description": "粒径在纳米级别的药物载体系统",
                "关键特征": ["增强渗透", "靶向递送", "提高溶解度", "减少副作用"],
                "工艺步骤": [
                    {"name": "聚合物溶解", "关键参数": ["聚合物选择", "溶剂系统", "浓度"], "设备": ["溶解系统", "混合器"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "药物加入", "关键参数": ["加入方式", "药物状态"], "设备": ["加药系统", "混合装置"], "时间(h)": 2, "温度(℃)": "室温"},
                    {"name": "纳米制备", "关键参数": ["制备方法", "粒径控制", "PDI"], "设备": ["高压均质机", "微流控设备"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "纯化", "关键参数": ["纯化方法", "游离药物去除", "收率"], "设备": ["超滤系统", "离心系统"], "时间(h)": 8, "温度(℃)": "4-8"},
                    {"name": "冷冻干燥", "关键参数": ["冻干配方", "冻干程序", "复溶性能"], "设备": ["冷冻干燥机", "冻干瓶"], "时间(天)": 3, "温度(℃)": "-40~25"},
                    {"name": "无菌处理", "关键参数": ["无菌工艺", "终端灭菌"], "设备": ["无菌过滤系统", "辐照设备"], "时间(h)": 4, "温度(℃)": "多种"},
                    {"name": "包装", "关键参数": ["无菌分装", "储存要求"], "设备": ["无菌分装机", "封口机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            }
        },
        
        "新型制剂-透皮给药系统": {
            "透皮贴剂": {
                "description": "药物通过皮肤吸收进入全身循环的制剂",
                "关键特征": ["避免首过效应", "血药浓度稳定", "使用方便", "提高依从性"],
                "工艺步骤": [
                    {"name": "药物处理", "关键参数": ["药物形态", "溶解度", "粒径"], "设备": ["粉碎机", "溶解罐"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "压敏胶制备", "关键参数": ["胶体粘度", "粘附力", "皮肤相容性"], "设备": ["混合机", "脱泡机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "药物混合", "关键参数": ["混合均匀度", "药物分散"], "设备": ["行星搅拌机", "均质机"], "时间(h)": 5, "温度(℃)": "室温"},
                    {"name": "涂布", "关键参数": ["涂布厚度", "涂布均匀性", "宽度"], "设备": ["涂布机", "厚度监测"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "干燥", "关键参数": ["干燥温度", "干燥时间", "溶剂残留"], "设备": ["干燥隧道", "烘箱"], "时间(h)": 12, "温度(℃)": "60-80"},
                    {"name": "复合背衬", "关键参数": ["复合强度", "无气泡", "对齐度"], "设备": ["复合机", "裁切机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "裁切", "关键参数": ["尺寸精度", "边缘整齐"], "设备": ["模切机", "冲切机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["铝箔袋包装", "密封性"], "设备": ["袋包装机", "装盒机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "凝胶贴膏": {
                "description": "药物与亲水性高分子基质制成的贴膏剂",
                "关键特征": ["皮肤相容性好", "无残留", "载药量较高", "使用舒适"],
                "工艺步骤": [
                    {"name": "基质制备", "关键参数": ["高分子浓度", "溶胀时间", "粘度"], "设备": ["溶胀罐", "搅拌器"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "药物加入", "关键参数": ["加入方式", "分散均匀性"], "设备": ["混合机", "均质机"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "脱泡", "关键参数": ["真空度", "脱泡时间", "气泡残留"], "设备": ["真空脱泡机", "离心脱泡机"], "时间(h)": 3, "温度(℃)": "室温"},
                    {"name": "涂布", "关键参数": ["涂布重量", "均匀性", "表面平整"], "设备": ["涂布机", "重量监测"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "交联", "关键参数": ["交联剂浓度", "交联时间", "交联温度"], "设备": ["交联室", "温控系统"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "复合切割", "关键参数": ["复合质量", "切割尺寸"], "设备": ["复合机", "模切机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["防粘包装", "使用说明"], "设备": ["袋包装机", "装盒机"], "时间(h)": 5, "温度(℃)": "室温"}
                ]
            }
        },
        
        "新型制剂-吸入制剂": {
            "干粉吸入剂(DPI)": {
                "description": "微粉化药物与载体混合制成的供吸入给药的粉末制剂",
                "关键特征": ["肺部给药", "无抛射剂", "使用方便", "剂量准确"],
                "工艺步骤": [
                    {"name": "药物微粉化", "关键参数": ["粒径分布", "比表面积", "结晶形态"], "设备": ["气流粉碎机", "喷雾干燥机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "载体处理", "关键参数": ["载体粒径", "表面性质", "干燥程度"], "设备": ["筛分机", "干燥机"], "时间(h)": 6, "温度(℃)": "60-80"},
                    {"name": "混合", "关键参数": ["混合比例", "混合时间", "混合均匀度"], "设备": ["混合机", "过筛混合机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "胶囊填充", "关键参数": ["装量差异", "胶囊型号"], "设备": ["胶囊填充机", "重量检查机"], "时间(h)": 10, "温度(℃)": "20-25"},
                    {"name": "装置组装", "关键参数": ["装置功能", "吸气阻力", "剂量准确性"], "设备": ["组装机", "功能测试仪"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["铝箔泡罩", "防潮包装"], "设备": ["泡罩包装机", "装盒机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "雾化吸入液": {
                "description": "供雾化器使用的液体制剂",
                "关键特征": ["适合重症", "剂量可调", "起效迅速", "使用方便"],
                "工艺步骤": [
                    {"name": "药物溶解", "关键参数": ["溶解完全", "溶液稳定性", "pH值"], "设备": ["溶解罐", "过滤器"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "过滤除菌", "关键参数": ["无菌过滤", "完整性测试"], "设备": ["除菌过滤器", "完整性测试仪"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "灌装", "关键参数": ["灌装精度", "无菌操作", "密封性"], "设备": ["无菌灌装机", "封口机"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["单剂量包装", "使用说明"], "设备": ["袋包装机", "装盒机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            }
        },
        
        "新型制剂-其他新型": {
            "植入剂": {
                "description": "药物与辅料制成的供植入体内的无菌固体制剂",
                "关键特征": ["长效缓释", "局部作用", "避免多次给药", "生物相容性好"],
                "工艺步骤": [
                    {"name": "基质处理", "关键参数": ["聚合物性质", "处理条件"], "设备": ["处理设备", "干燥机"], "时间(h)": 8, "温度(℃)": "多种"},
                    {"name": "药物混合", "关键参数": ["混合均匀度", "药物分散"], "设备": ["混合机", "挤出机"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "成型", "关键参数": ["成型方法", "尺寸精度", "表面性质"], "设备": ["压片机", "挤出成型机"], "时间(h)": 10, "温度(℃)": "室温"},
                    {"name": "灭菌", "关键参数": ["灭菌方法", "灭菌验证", "无菌保证"], "设备": ["辐照灭菌设备", "环氧乙烷灭菌柜"], "时间(h)": 12, "温度(℃)": "多种"},
                    {"name": "包装", "关键参数": ["无菌包装", "植入器械"], "设备": ["无菌包装机", "封口机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            },
            
            "微针": {
                "description": "微米级针头阵列构成的透皮给药系统",
                "关键特征": ["无痛给药", "透皮效率高", "剂量准确", "使用方便"],
                "工艺步骤": [
                    {"name": "模具制备", "关键参数": ["模具精度", "针型设计", "材质"], "设备": ["模具加工设备", "清洗设备"], "时间(h)": 24, "温度(℃)": "室温"},
                    {"name": "聚合物填充", "关键参数": ["聚合物溶液", "填充方法", "无气泡"], "设备": ["填充设备", "真空系统"], "时间(h)": 8, "温度(℃)": "室温"},
                    {"name": "固化", "关键参数": ["固化条件", "固化时间", "硬度"], "设备": ["固化装置", "温控系统"], "时间(h)": 6, "温度(℃)": "室温"},
                    {"name": "脱模", "关键参数": ["脱模完整性", "针尖质量"], "设备": ["脱模设备", "检查系统"], "时间(h)": 4, "温度(℃)": "室温"},
                    {"name": "载药", "关键参数": ["载药方法", "载药量", "均匀性"], "设备": ["载药设备", "干燥系统"], "time(h)": 8, "温度(℃)": "室温"},
                    {"name": "包装", "关键参数": ["无菌包装", "使用装置"], "设备": ["无菌包装机", "装盒机"], "时间(h)": 6, "温度(℃)": "室温"}
                ]
            }
        }
    }
    
    @staticmethod
    def get_main_categories():
        return list(PharmaceuticalProcesses.PROCESSES.keys())
    
    @staticmethod
    def get_products(main_category):
        return list(PharmaceuticalProcesses.PROCESSES.get(main_category, {}).keys())
    
    @staticmethod
    def get_product_info(main_category, product):
        return PharmaceuticalProcesses.PROCESSES.get(main_category, {}).get(product, {})

# 辅助方法
def classify_parameter(param_name):
    param_lower = param_name.lower()
    if any(word in param_lower for word in ['温度', '压力', 'ph', '浓度']):
        return "物理化学参数"
    elif any(word in param_lower for word in ['时间', '速率', '速度']):
        return "过程控制参数"
    elif any(word in param_lower for word in ['含量', '纯度', '杂质']):
        return "质量参数"
    elif any(word in param_lower for word in ['收率', '效率', '产量']):
        return "经济性参数"
    else:
        return "其他参数"

def assess_importance(param_name):
    param_lower = param_name.lower()
    if any(word in param_lower for word in ['无菌', '灭菌', '病毒', '安全']):
        return 5
    elif any(word in param_lower for word in ['含量', '纯度', '关键质量']):
        return 4
    elif any(word in param_lower for word in ['温度', '时间', 'ph']):
        return 3
    else:
        return 2

def classify_equipment(equip_name):
    equip_lower = equip_name.lower()
    if any(word in equip_lower for word in ['反应器', '发酵罐', '生物']):
        return "生物反应设备"
    elif any(word in equip_lower for word in ['离心', '过滤', '层析', '纯化']):
        return "分离纯化设备"
    elif any(word in equip_lower for word in ['干燥', '浓缩', '蒸发']):
        return "干燥浓缩设备"
    elif any(word in equip_lower for word in ['混合', '搅拌', '制粒']):
        return "混合制备设备"
    elif any(word in equip_lower for word in ['灌装', '包装', '贴标']):
        return "灌装包装设备"
    elif any(word in equip_lower for word in ['灭菌', '消毒']):
        return "灭菌消毒设备"
    else:
        return "其他设备"

# 侧边栏配置
with st.sidebar:
    st.markdown('<div class="custom-card">', unsafe_allow_html=True)
    st.markdown('### ⚙️ 配置选项')
    
    mode = st.radio(
        "选择查看模式",
        ["单一产品详情", "多产品对比", "分类概览"],
        index=0
    )
    
    st.markdown("---")
    
    if mode == "单一产品详情":
        st.markdown('#### 选择产品')
        main_categories = PharmaceuticalProcesses.get_main_categories()
        selected_main = st.selectbox("选择药品主分类", main_categories, index=0)
        
        if selected_main:
            products = PharmaceuticalProcesses.get_products(selected_main)
            selected_product = st.selectbox("选择具体产品", products, index=0)
            
            product_info = PharmaceuticalProcesses.get_product_info(selected_main, selected_product)
            if product_info:
                with st.expander("📝 产品简介"):
                    st.write(f"**描述**: {product_info.get('description', '')}")
                    st.write("**关键特征**:")
                    for feature in product_info.get("关键特征", []):
                        st.write(f"- {feature}")
    
    elif mode == "多产品对比":
        st.markdown('#### 选择对比产品')
        all_products = []
        for main_cat in PharmaceuticalProcesses.get_main_categories():
            for product in PharmaceuticalProcesses.get_products(main_cat):
                all_products.append(f"{main_cat} | {product}")
        
        selected_comparison = st.multiselect(
            "选择要对比的产品（最多6个）",
            all_products,
            default=all_products[:3] if len(all_products) >= 3 else all_products
        )
        
        if len(selected_comparison) > 6:
            st.warning("最多选择6个产品进行对比")
            selected_comparison = selected_comparison[:6]
    
    else:
        st.markdown('#### 分类概览设置')
        overview_type = st.selectbox(
            "概览类型",
            ["工艺步骤数对比", "工艺复杂度雷达图", "设备需求对比"]
        )
    
    st.markdown("---")
    st.caption("💡 提示：点击不同标签页查看详细信息")
    st.markdown('</div>', unsafe_allow_html=True)

# 主显示区域
if mode == "单一产品详情":
    if 'selected_main' in locals() and 'selected_product' in locals():
        product_info = PharmaceuticalProcesses.get_product_info(selected_main, selected_product)
        
        if product_info:
            # 产品标题
            st.markdown(f'<div class="custom-card"><h2>🔬 {selected_product} 生产工艺流程</h2><p>所属分类: {selected_main}</p></div>', unsafe_allow_html=True)
            
            # 创建标签页
            tab1, tab2, tab3, tab4 = st.tabs(["📋 工艺步骤详情", "🔧 关键参数分析", "🏭 设备需求", "📊 工艺流程图"])
            
            with tab1:
                st.markdown('<div class="custom-card">', unsafe_allow_html=True)
                st.subheader("工艺步骤详解")
                steps = product_info.get("工艺步骤", [])
                
                for i, step in enumerate(steps, 1):
                    with st.expander(f"步骤{i}: {step['name']}", expanded=(i==1)):
                        col1, col2, col3 = st.columns([2, 2, 1])
                        
                        with col1:
                            st.markdown("**关键参数:**")
                            for param in step.get("关键参数", []):
                                st.write(f"• {param}")
                        
                        with col2:
                            st.markdown("**主要设备:**")
                            for equip in step.get("设备", []):
                                st.write(f"• {equip}")
                        
                        with col3:
                            # 工艺条件
                            if "时间" in step:
                                st.metric("工艺时间", step.get("时间", ""))
                            if "温度" in step:
                                st.metric("工艺温度", step.get("温度", ""))
                
                st.markdown('</div>', unsafe_allow_html=True)
                
                # 工艺统计
                st.markdown('<div class="custom-card">', unsafe_allow_html=True)
                st.subheader("工艺统计")
                col1, col2, col3, col4 = st.columns(4)
                
                with col1:
                    st.metric("总步骤数", len(steps))
                
                with col2:
                    total_params = sum(len(step.get("关键参数", [])) for step in steps)
                    st.metric("关键参数总数", total_params)
                
                with col3:
                    all_equipment = set()
                    for step in steps:
                        all_equipment.update(step.get("设备", []))
                    st.metric("设备种类数", len(all_equipment))
                
                with col4:
                    total_time = sum(float(str(step.get("时间", "0")).replace("(h)", "").replace("(天)", "")) 
                                   for step in steps if "时间" in step)
                    st.metric("总工艺时间", f"{total_time:.1f} 小时")
                st.markdown('</div>', unsafe_allow_html=True)
            
            with tab2:
                st.markdown('<div class="custom-card">', unsafe_allow_html=True)
                st.subheader("关键参数分析")
                steps = product_info.get("工艺步骤", [])
                all_params = []
                
                for step in steps:
                    for param in step.get("关键参数", []):
                        all_params.append({
                            "参数名称": param,
                            "所属步骤": step["name"],
                            "参数类型": classify_parameter(param),
                            "重要程度": assess_importance(param)
                        })
                
                if all_params:
                    params_df = pd.DataFrame(all_params)
                    
                    # 优化饼图颜色 - 使用高对比度配色
                    param_counts = params_df["参数类型"].value_counts()
                    
                    # 使用暗色主题友好的颜色
                    colors = ['#636efa', '#ef553b', '#00cc96', '#ab63fa', '#ffa15a']
                    
                    fig1 = px.pie(
                        values=param_counts.values,
                        names=param_counts.index,
                        title="关键参数类型分布",
                        color_discrete_sequence=colors
                    )
                    
                    # 更新饼图样式为暗色主题
                    fig1.update_layout(
                        paper_bgcolor='rgba(0,0,0,0)',
                        plot_bgcolor='rgba(0,0,0,0)',
                        font_color='white',
                        title_font_color='white',
                        legend_font_color='white'
                    )
                    
                    fig1.update_traces(
                        textfont_color='white',
                        marker=dict(line=dict(color='#2d3746', width=2))
                    )
                    
                    st.plotly_chart(fig1, use_container_width=True)
                    
                    # 参数详情表格
                    st.write("### 参数详情")
                    st.dataframe(
                        params_df,
                        column_config={
                            "参数名称": st.column_config.TextColumn("参数名称"),
                            "所属步骤": st.column_config.TextColumn("所属步骤"),
                            "参数类型": st.column_config.TextColumn("参数类型"),
                            "重要程度": st.column_config.ProgressColumn(
                                "重要程度",
                                min_value=1,
                                max_value=5
                            )
                        },
                        use_container_width=True
                    )
                st.markdown('</div>', unsafe_allow_html=True)
            
            with tab3:
                st.markdown('<div class="custom-card">', unsafe_allow_html=True)
                st.subheader("设备需求分析")
                steps = product_info.get("工艺步骤", [])
                equipment_data = []
                
                for step in steps:
                    for equip in step.get("设备", []):
                        equipment_data.append({
                            "设备名称": equip,
                            "使用步骤": step["name"],
                            "设备类型": classify_equipment(equip),
                            "使用频率": 1
                        })
                
                if equipment_data:
                    equip_df = pd.DataFrame(equipment_data)
                    
                    # 优化柱状图颜色
                    equip_type_counts = equip_df["设备类型"].value_counts()
                    
                    fig2 = px.bar(
                        x=equip_type_counts.index,
                        y=equip_type_counts.values,
                        title="设备类型分布",
                        labels={"x": "设备类型", "y": "使用次数"},
                        color=equip_type_counts.index,
                        color_discrete_sequence=px.colors.qualitative.Set3
                    )
                    
                    # 更新柱状图样式为暗色主题
                    fig2.update_layout(
                        paper_bgcolor='rgba(0,0,0,0)',
                        plot_bgcolor='rgba(0,0,0,0)',
                        font_color='white',
                        title_font_color='white',
                        xaxis=dict(gridcolor='#2d3746'),
                        yaxis=dict(gridcolor='#2d3746')
                    )
                    
                    st.plotly_chart(fig2, use_container_width=True)
                    
                    # 详细设备列表
                    st.write("### 详细设备清单")
                    equip_summary = equip_df.groupby("设备名称").agg({
                        "设备类型": "first",
                        "使用频率": "sum",
                        "使用步骤": lambda x: ", ".join(x)
                    }).reset_index()
                    
                    st.dataframe(
                        equip_summary,
                        column_config={
                            "设备名称": st.column_config.TextColumn("设备名称"),
                            "设备类型": st.column_config.TextColumn("设备类型"),
                            "使用频率": st.column_config.NumberColumn("使用次数"),
                            "使用步骤": st.column_config.TextColumn("使用步骤", width="large")
                        },
                        use_container_width=True
                    )
                st.markdown('</div>', unsafe_allow_html=True)
            
            with tab4:
                st.markdown('<div class="custom-card">', unsafe_allow_html=True)
                st.subheader("工艺流程图")
                steps = product_info.get("工艺步骤", [])
                
                # 创建优化的流程图 - 使用Plotly
                fig = go.Figure()
                
                # 计算节点位置
                num_steps = len(steps)
                x_positions = [i/(num_steps-1) if num_steps > 1 else 0.5 for i in range(num_steps)]
                y_position = 0.5
                
                # 定义节点颜色方案
                node_colors = ['#636efa', '#ef553b', '#00cc96', '#ab63fa', '#ffa15a', 
                              '#19d3f3', '#ff6692', '#b6e880', '#ff97ff', '#fecb52']
                
                # 添加节点
                for i, step in enumerate(steps):
                    color_idx = i % len(node_colors)
                    
                    # 添加主要节点
                    fig.add_trace(go.Scatter(
                        x=[x_positions[i]],
                        y=[y_position],
                        mode="markers+text",
                        marker=dict(
                            size=40,
                            color=node_colors[color_idx],
                            line=dict(width=3, color='white')
                        ),
                        text=[f"{i+1}"],
                        textposition="middle center",
                        textfont=dict(size=14, color="white", family="Arial Black"),
                        name=step["name"],
                        hoverinfo="text",
                        hovertext=f"<b>{step['name']}</b><br>关键参数: {', '.join(step.get('关键参数', []))}<br>设备: {', '.join(step.get('设备', []))}"
                    ))
                    
                    # 添加步骤名称标签
                    fig.add_annotation(
                        x=x_positions[i],
                        y=y_position - 0.15,
                        text=step["name"],
                        showarrow=False,
                        font=dict(size=12, color="#e0e0e0", family="Arial"),
                        yref="y"
                    )
                
                # 添加工艺连接线
                for i in range(num_steps - 1):
                    fig.add_trace(go.Scatter(
                        x=[x_positions[i] + 0.03, x_positions[i+1] - 0.03],
                        y=[y_position, y_position],
                        mode="lines",
                        line=dict(width=3, color='#667eea', dash='solid'),
                        hoverinfo="none",
                        showlegend=False
                    ))
                    
                    # 添加流向箭头
                    mid_x = (x_positions[i] + x_positions[i+1]) / 2
                    fig.add_annotation(
                        x=mid_x,
                        y=y_position,
                        ax=mid_x - 0.02,
                        ay=y_position,
                        xref="x",
                        yref="y",
                        axref="x",
                        ayref="y",
                        showarrow=True,
                        arrowhead=3,
                        arrowsize=1.5,
                        arrowwidth=2,
                        arrowcolor="#ffffff"
                    )
                
                # 添加工艺开始和结束标记
                fig.add_annotation(
                    x=-0.05,
                    y=y_position,
                    text="🏁 开始",
                    showarrow=False,
                    font=dict(size=14, color="#00cc96", family="Arial Black"),
                    xref="paper"
                )
                
                fig.add_annotation(
                    x=1.05,
                    y=y_position,
                    text="✅ 完成",
                    showarrow=False,
                    font=dict(size=14, color="#00cc96", family="Arial Black"),
                    xref="paper"
                )
                
                # 更新布局 - 优化暗色主题
                fig.update_layout(
                    title=dict(
                        text=f"{selected_product} 工艺流程图",
                        font=dict(size=20, color="white", family="Arial Black"),
                        x=0.5,
                        xanchor="center"
                    ),
                    height=400,
                    showlegend=False,
                    xaxis=dict(
                        showgrid=False,
                        zeroline=False,
                        showticklabels=False,
                        range=[-0.15, 1.15]
                    ),
                    yaxis=dict(
                        showgrid=False,
                        zeroline=False,
                        showticklabels=False,
                        range=[0, 1]
                    ),
                    paper_bgcolor='rgba(0,0,0,0)',
                    plot_bgcolor='rgba(0,0,0,0)',
                    margin=dict(l=50, r=50, t=80, b=50),
                    hoverlabel=dict(
                        bgcolor="#1e2130",
                        font_size=12,
                        font_color="white"
                    )
                )
                
                st.plotly_chart(fig, use_container_width=True)
                
                # 流程图说明
                st.info("""
                **流程图说明:**
                - 🔵 每个彩色圆点代表一个工艺步骤，数字表示步骤顺序
                - ⬇️ 下方文字显示步骤名称
                - ⬅️ 箭头表示工艺流向
                - 💡 悬停在圆点上查看详细参数和设备信息
                - 🏁 左侧为工艺开始，✅ 右侧为工艺完成
                """)
                st.markdown('</div>', unsafe_allow_html=True)
    
    else:
        st.info("请在侧边栏选择产品和分类")

elif mode == "多产品对比":
    st.header("📊 多产品工艺对比分析")
    
    if 'selected_comparison' in locals() and selected_comparison:
        st.markdown('<div class="custom-card">', unsafe_allow_html=True)
        st.subheader("产品基本信息对比")
        
        # 这里简化对比逻辑，重点展示工艺差异
        comparison_data = []
        for product_path in selected_comparison:
            parts = product_path.split(" | ")
            if len(parts) == 2:
                main_cat, product = parts
                product_info = PharmaceuticalProcesses.get_product_info(main_cat, product)
                if product_info:
                    steps = product_info.get("工艺步骤", [])
                    comparison_data.append({
                        "产品名称": product,
                        "所属分类": main_cat,
                        "工艺步骤数": len(steps),
                        "关键参数总数": sum(len(step.get("关键参数", [])) for step in steps),
                        "设备种类数": len(set([equip for step in steps for equip in step.get("设备", [])]))
                    })
        
        if comparison_data:
            comparison_df = pd.DataFrame(comparison_data)
            
            # 显示对比表格
            st.dataframe(
                comparison_df,
                column_config={
                    "产品名称": st.column_config.TextColumn("产品名称"),
                    "所属分类": st.column_config.TextColumn("所属分类"),
                    "工艺步骤数": st.column_config.NumberColumn("工艺步骤数"),
                    "关键参数总数": st.column_config.NumberColumn("关键参数总数"),
                    "设备种类数": st.column_config.NumberColumn("设备种类数")
                },
                use_container_width=True,
                hide_index=True
            )
            
            # 创建对比图表
            col1, col2 = st.columns(2)
            
            with col1:
                fig1 = px.bar(
                    comparison_df,
                    x="产品名称",
                    y="工艺步骤数",
                    color="所属分类",
                    title="各产品工艺步骤数对比",
                    color_discrete_sequence=px.colors.qualitative.Set3
                )
                
                fig1.update_layout(
                    paper_bgcolor='rgba(0,0,0,0)',
                    plot_bgcolor='rgba(0,0,0,0)',
                    font_color='white',
                    title_font_color='white'
                )
                
                st.plotly_chart(fig1, use_container_width=True)
            
            with col2:
                fig2 = px.scatter(
                    comparison_df,
                    x="关键参数总数",
                    y="设备种类数",
                    size="工艺步骤数",
                    color="所属分类",
                    text="产品名称",
                    title="复杂度分析",
                    color_discrete_sequence=px.colors.qualitative.Set3
                )
                
                fig2.update_layout(
                    paper_bgcolor='rgba(0,0,0,0)',
                    plot_bgcolor='rgba(0,0,0,0)',
                    font_color='white',
                    title_font_color='white'
                )
                
                st.plotly_chart(fig2, use_container_width=True)
        st.markdown('</div>', unsafe_allow_html=True)
    
    else:
        st.info("请在侧边栏选择要对比的产品")

else:  # 分类概览
    st.header("🌐 制药品类工艺概览")
    st.markdown('<div class="custom-card">', unsafe_allow_html=True)
    
    # 获取所有产品数据
    all_products_data = []
    for main_cat in PharmaceuticalProcesses.get_main_categories():
        for product in PharmaceuticalProcesses.get_products(main_cat):
            product_info = PharmaceuticalProcesses.get_product_info(main_cat, product)
            if product_info:
                steps = product_info.get("工艺步骤", [])
                all_products_data.append({
                    "产品": product,
                    "分类": main_cat,
                    "子分类": main_cat.split("-")[-1] if "-" in main_cat else main_cat,
                    "步骤数": len(steps),
                    "关键参数总数": sum(len(step.get("关键参数", [])) for step in steps),
                    "设备种类数": len(set([equip for step in steps for equip in step.get("设备", [])]))
                })
    
    if all_products_data:
        overview_df = pd.DataFrame(all_products_data)
        
        if 'overview_type' in locals() and overview_type == "工艺步骤数对比":
            st.subheader("各品类工艺步骤数对比")
            
            # 创建分类对比图
            category_stats = overview_df.groupby("分类").agg({
                "步骤数": ["mean", "min", "max", "count"]
            }).round(1).reset_index()
            
            category_stats.columns = ["分类", "平均步骤数", "最少步骤数", "最多步骤数", "产品数量"]
            
            fig = px.bar(
                category_stats,
                x="分类",
                y="平均步骤数",
                error_y="最多步骤数",
                title="各分类平均工艺步骤数对比",
                color="分类",
                color_discrete_sequence=px.colors.qualitative.Set3
            )
            
            fig.update_layout(
                paper_bgcolor='rgba(0,0,0,0)',
                plot_bgcolor='rgba(0,0,0,0)',
                font_color='white',
                title_font_color='white'
            )
            
            st.plotly_chart(fig, use_container_width=True)
    
    st.markdown('</div>', unsafe_allow_html=True)

# 页脚
st.markdown("---")
st.markdown(
    """
    <div style='text-align: center; padding: 20px; background: linear-gradient(135deg, #1a1d2e 0%, #2d3746 100%); border-radius: 10px;'>
        <h3 style='color: #ffffff; margin-bottom: 10px;'>⚗️ 制药工艺流程对比</h3>
        <p style='color: #b0b0b0; font-size: 0.9em;'>
            专注于展示不同制药品类的工艺差异 | 数据来源: 制药工艺专业资料整理
        </p>
        <p style='color: #999999; font-size: 0.8em;'>
            版本 2.0 | 优化暗色主题 | 增强可视化效果
        </p>
    </div>
    """,
    unsafe_allow_html=True
)
