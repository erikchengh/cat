import streamlit as st
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(
    page_title="åˆ¶è¯å·¥è‰ºæµç¨‹å¯¹æ¯”ç³»ç»Ÿ",
    page_icon="âš—ï¸",
    layout="wide",
    initial_sidebar_state="expanded"
)

# åº”ç”¨æ ‡é¢˜
st.title("âš—ï¸ åˆ¶è¯å·¥è‰ºæµç¨‹å¯¹æ¯”ç³»ç»Ÿ")
st.markdown("### å¯è§†åŒ–å±•ç¤ºä¸åŒåˆ¶è¯å“ç±»çš„å·¥è‰ºæ­¥éª¤åŠå…¶å·®å¼‚")

# å®šä¹‰è¯¦ç»†çš„åˆ¶è¯å·¥è‰ºæ•°æ®åº“
class PharmaceuticalProcesses:
    """åˆ¶è¯å·¥è‰ºæ•°æ®åº“"""
    
    PROCESSES = {
        # 1. åŒ–å­¦è¯ç‰© - å›ºä½“åˆ¶å‰‚
        "åŒ–å­¦è¯ç‰©-å›ºä½“åˆ¶å‰‚": {
            "ç‰‡å‰‚": {
                "description": "æœ€å¸¸è§çš„å£æœå›ºä½“åˆ¶å‰‚ï¼Œé€šè¿‡ç²‰æœ«å‹ç¼©æˆå‹",
                "å…³é”®ç‰¹å¾": ["å‰‚é‡å‡†ç¡®", "ç¨³å®šæ€§å¥½", "ä¾¿äºæœç”¨"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "åŸæ–™éªŒæ”¶", "å…³é”®å‚æ•°": ["å«é‡", "æ‚è´¨", "ç²’åº¦"], "è®¾å¤‡": ["å¤©å¹³", "ç­›åˆ†æœº"]},
                    {"name": "ç§°é…", "å…³é”®å‚æ•°": ["ç§°é‡ç²¾åº¦", "å¤æ ¸ç¡®è®¤"], "è®¾å¤‡": ["ç²¾å¯†å¤©å¹³"]},
                    {"name": "åˆ¶ç²’", "å…³é”®å‚æ•°": ["ç²˜åˆå‰‚æµ“åº¦", "æ…æ‹Œæ—¶é—´", "ç²’åº¦åˆ†å¸ƒ"], "è®¾å¤‡": ["æ¹¿æ³•åˆ¶ç²’æœº"]},
                    {"name": "å¹²ç‡¥", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æ—¶é—´", "æ°´åˆ†å«é‡"], "è®¾å¤‡": ["æµåŒ–åºŠå¹²ç‡¥æœº"]},
                    {"name": "æ•´ç²’", "å…³é”®å‚æ•°": ["ç­›ç½‘ç›®æ•°", "é¢—ç²’æ”¶ç‡"], "è®¾å¤‡": ["æ•´ç²’æœº"]},
                    {"name": "æ€»æ··", "å…³é”®å‚æ•°": ["æ··åˆæ—¶é—´", "å‡åŒ€åº¦"], "è®¾å¤‡": ["ä¸‰ç»´æ··åˆæœº"]},
                    {"name": "å‹ç‰‡", "å…³é”®å‚æ•°": ["å‹åŠ›", "ç¡¬åº¦", "ç‰‡é‡å·®å¼‚"], "è®¾å¤‡": ["æ—‹è½¬å‹ç‰‡æœº"]},
                    {"name": "åŒ…è¡£", "å…³é”®å‚æ•°": ["åŒ…è¡£æ¶²æµ“åº¦", "å–·é›¾é€Ÿç‡", "æ¸©åº¦"], "è®¾å¤‡": ["åŒ…è¡£é”…"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°æ€§", "æ ‡ç­¾å‡†ç¡®æ€§"], "è®¾å¤‡": ["æ³¡ç½©åŒ…è£…æœº"]}
                ]
            },
            
            "èƒ¶å›Šå‰‚": {
                "description": "è¯ç‰©å°è£…åœ¨æ˜èƒ¶æˆ–æ¤ç‰©èƒ¶å›Šä¸­",
                "å…³é”®ç‰¹å¾": ["æ©ç›–ä¸è‰¯å‘³é“", "æé«˜ç”Ÿç‰©åˆ©ç”¨åº¦", "ä¾¿äºä¸ªæ€§åŒ–"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "åŸæ–™å¤„ç†", "å…³é”®å‚æ•°": ["ç²’åº¦", "æµåŠ¨æ€§"], "è®¾å¤‡": ["ç²‰ç¢æœº", "ç­›åˆ†æœº"]},
                    {"name": "ç§°é…", "å…³é”®å‚æ•°": ["ç§°é‡ç²¾åº¦"], "è®¾å¤‡": ["ç²¾å¯†å¤©å¹³"]},
                    {"name": "æ··åˆ", "å…³é”®å‚æ•°": ["æ··åˆå‡åŒ€åº¦"], "è®¾å¤‡": ["Vå‹æ··åˆæœº"]},
                    {"name": "èƒ¶å›Šå¡«å……", "å…³é”®å‚æ•°": ["è£…é‡å·®å¼‚", "é”åˆå®Œæ•´æ€§"], "è®¾å¤‡": ["å…¨è‡ªåŠ¨èƒ¶å›Šå¡«å……æœº"]},
                    {"name": "æŠ›å…‰", "å…³é”®å‚æ•°": ["å¤–è§‚", "æ¸…æ´åº¦"], "è®¾å¤‡": ["èƒ¶å›ŠæŠ›å…‰æœº"]},
                    {"name": "æ£€æŸ¥", "å…³é”®å‚æ•°": ["å¤–è§‚", "é‡é‡å·®å¼‚"], "è®¾å¤‡": ["èƒ¶å›Šæ£€æŸ¥æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°æ€§", "é˜²æ½®æ€§"], "è®¾å¤‡": ["è£…ç“¶æœº"]}
                ]
            },
            
            "é¢—ç²’å‰‚": {
                "description": "è¯ç‰©ä¸è¾…æ–™åˆ¶æˆçš„å¹²ç‡¥é¢—ç²’çŠ¶åˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["åˆ†æ•£æ€§å¥½", "å‰‚é‡å‡†ç¡®", "ä¾¿äºå„¿ç«¥æœç”¨"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "åŸæ–™å¤„ç†", "å…³é”®å‚æ•°": ["ç²’åº¦", "æ°´åˆ†"], "è®¾å¤‡": ["ç²‰ç¢æœº"]},
                    {"name": "ç§°é…", "å…³é”®å‚æ•°": ["é…æ¯”å‡†ç¡®æ€§"], "è®¾å¤‡": ["å°ç§¤"]},
                    {"name": "åˆ¶ç²’", "å…³é”®å‚æ•°": ["ç²’åº¦åˆ†å¸ƒ", "æ”¶ç‡"], "è®¾å¤‡": ["å¹²æ³•åˆ¶ç²’æœº"]},
                    {"name": "æ•´ç²’", "å…³é”®å‚æ•°": ["é¢—ç²’å‡åŒ€åº¦"], "è®¾å¤‡": ["æŒ¯è¡ç­›"]},
                    {"name": "æ€»æ··", "å…³é”®å‚æ•°": ["æ··åˆå‡åŒ€åº¦"], "è®¾å¤‡": ["åŒé”¥æ··åˆæœº"]},
                    {"name": "åˆ†è£…", "å…³é”®å‚æ•°": ["è£…é‡å·®å¼‚"], "è®¾å¤‡": ["è‡ªåŠ¨åˆ†è£…æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°æ€§"], "è®¾å¤‡": ["è¢‹åŒ…è£…æœº"]}
                ]
            }
        },
        
        # 2. åŒ–å­¦è¯ç‰© - åŠå›ºä½“åˆ¶å‰‚
        "åŒ–å­¦è¯ç‰©-åŠå›ºä½“åˆ¶å‰‚": {
            "è½¯è†å‰‚": {
                "description": "è¯ç‰©ä¸æ²¹è„‚æ€§æˆ–æ°´æº¶æ€§åŸºè´¨æ··åˆåˆ¶æˆçš„åŠå›ºä½“åˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["å±€éƒ¨ç»™è¯", "ç¼“é‡Šä½œç”¨", "ä¿æŠ¤åˆ›é¢"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "åŸºè´¨å¤„ç†", "å…³é”®å‚æ•°": ["ç†”ç‚¹", "çº¯å‡€åº¦"], "è®¾å¤‡": ["åŠ çƒ­ç½"]},
                    {"name": "è¯ç‰©åˆ†æ•£", "å…³é”®å‚æ•°": ["åˆ†æ•£å‡åŒ€åº¦", "ç²’åº¦"], "è®¾å¤‡": ["èƒ¶ä½“ç£¨"]},
                    {"name": "å‡è´¨ä¹³åŒ–", "å…³é”®å‚æ•°": ["ä¹³åŒ–æ—¶é—´", "æ¸©åº¦", "pHå€¼"], "è®¾å¤‡": ["å‡è´¨ä¹³åŒ–æœº"]},
                    {"name": "è„±æ°”", "å…³é”®å‚æ•°": ["æ°”æ³¡å«é‡"], "è®¾å¤‡": ["çœŸç©ºè„±æ°”ç½"]},
                    {"name": "çŒè£…", "å…³é”®å‚æ•°": ["è£…é‡å·®å¼‚", "å¯†å°æ€§"], "è®¾å¤‡": ["è½¯è†çŒè£…æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°å®Œæ•´æ€§"], "è®¾å¤‡": ["æ—‹ç›–æœº"]}
                ]
            },
            
            "å‡èƒ¶å‰‚": {
                "description": "è¯ç‰©ä¸äº²æ°´æ€§åŸºè´¨åˆ¶æˆçš„é€æ˜æˆ–åŠé€æ˜åŠå›ºä½“åˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["ç”Ÿç‰©ç›¸å®¹æ€§å¥½", "é€çš®å¸æ”¶", "ç¾è§‚"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "åŸºè´¨åˆ¶å¤‡", "å…³é”®å‚æ•°": ["ç²˜åº¦", "é€æ˜åº¦"], "è®¾å¤‡": ["æ…æ‹Œç½"]},
                    {"name": "è¯ç‰©æº¶è§£", "å…³é”®å‚æ•°": ["æº¶è§£åº¦", "ç¨³å®šæ€§"], "è®¾å¤‡": ["æº¶è§£ç½"]},
                    {"name": "æ··åˆ", "å…³é”®å‚æ•°": ["æ··åˆå‡åŒ€åº¦"], "è®¾å¤‡": ["è¡Œæ˜Ÿæ…æ‹Œæœº"]},
                    {"name": "è„±æ³¡", "å…³é”®å‚æ•°": ["æ°”æ³¡æ¶ˆé™¤"], "è®¾å¤‡": ["çœŸç©ºè„±æ³¡æœº"]},
                    {"name": "çŒè£…", "å…³é”®å‚æ•°": ["è£…é‡ç²¾åº¦"], "è®¾å¤‡": ["å‡èƒ¶çŒè£…æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°æ€§"], "è®¾å¤‡": ["é“ç®¡å°å°¾æœº"]}
                ]
            },
            
            "æ “å‰‚": {
                "description": "è¯ç‰©ä¸é€‚å®œåŸºè´¨åˆ¶æˆçš„ä¾›è…”é“ç»™è¯çš„å›ºä½“åˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["é¿å…é¦–è¿‡æ•ˆåº”", "å±€éƒ¨æˆ–å…¨èº«ä½œç”¨"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "åŸºè´¨ç†”è", "å…³é”®å‚æ•°": ["ç†”èæ¸©åº¦", "æ—¶é—´"], "è®¾å¤‡": ["æ°´æµ´é”…"]},
                    {"name": "è¯ç‰©åˆ†æ•£", "å…³é”®å‚æ•°": ["åˆ†æ•£å‡åŒ€åº¦"], "è®¾å¤‡": ["æ…æ‹Œå™¨"]},
                    {"name": "æµ‡æ³¨", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æµ‡æ³¨é€Ÿåº¦"], "è®¾å¤‡": ["æ “å‰‚æµ‡æ³¨æœº"]},
                    {"name": "å†·å´å®šå‹", "å…³é”®å‚æ•°": ["å†·å´é€Ÿç‡"], "è®¾å¤‡": ["å†·å´éš§é“"]},
                    {"name": "è„±æ¨¡", "å…³é”®å‚æ•°": ["å®Œæ•´æ€§", "å¤–è§‚"], "è®¾å¤‡": ["è„±æ¨¡æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°æ€§", "å«ç”Ÿ"], "è®¾å¤‡": ["æ³¡ç½©åŒ…è£…æœº"]}
                ]
            }
        },
        
        # 3. åŒ–å­¦è¯ç‰© - æ¶²ä½“åˆ¶å‰‚
        "åŒ–å­¦è¯ç‰©-æ¶²ä½“åˆ¶å‰‚": {
            "æ³¨å°„å‰‚": {
                "description": "ä¾›æ³¨å…¥ä½“å†…çš„æ— èŒåˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["èµ·æ•ˆè¿…é€Ÿ", "ç”Ÿç‰©åˆ©ç”¨åº¦é«˜", "æ— èŒè¦æ±‚ä¸¥æ ¼"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "é…æ¶²", "å…³é”®å‚æ•°": ["æµ“åº¦", "pHå€¼", "æ¾„æ˜åº¦"], "è®¾å¤‡": ["é…æ¶²ç½"]},
                    {"name": "è¿‡æ»¤", "å…³é”®å‚æ•°": ["æ»¤å™¨å®Œæ•´æ€§", "é™¤èŒæ•ˆæœ"], "è®¾å¤‡": ["é™¤èŒè¿‡æ»¤å™¨"]},
                    {"name": "çŒå°", "å…³é”®å‚æ•°": ["çŒè£…ç²¾åº¦", "å¯†å°æ€§"], "è®¾å¤‡": ["æ´—çƒ˜çŒå°è”åŠ¨çº¿"]},
                    {"name": "ç­èŒ", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æ—¶é—´", "F0å€¼"], "è®¾å¤‡": ["è’¸æ±½ç­èŒæŸœ"]},
                    {"name": "ç¯æ£€", "å…³é”®å‚æ•°": ["å¯è§å¼‚ç‰©"], "è®¾å¤‡": ["è‡ªåŠ¨ç¯æ£€æœº"]},
                    {"name": "è´´ç­¾åŒ…è£…", "å…³é”®å‚æ•°": ["æ ‡ç­¾å‡†ç¡®æ€§", "å¯†å°æ€§"], "è®¾å¤‡": ["è´´æ ‡æœº"]}
                ]
            },
            
            "å£æœæ¶²": {
                "description": "ä¾›å£æœçš„æ¶²ä½“åˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["å¸æ”¶å¿«", "ä¾¿äºå„¿ç«¥è€äººæœç”¨"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "è¯ææå–", "å…³é”®å‚æ•°": ["æå–ç‡", "æœ‰æ•ˆæˆåˆ†"], "è®¾å¤‡": ["æå–ç½"]},
                    {"name": "è¿‡æ»¤æµ“ç¼©", "å…³é”®å‚æ•°": ["æ¾„æ¸…åº¦", "ç›¸å¯¹å¯†åº¦"], "è®¾å¤‡": ["çœŸç©ºæµ“ç¼©å™¨"]},
                    {"name": "é…åˆ¶", "å…³é”®å‚æ•°": ["pHå€¼", "ç³–åº¦"], "è®¾å¤‡": ["é…æ¶²ç½"]},
                    {"name": "è¿‡æ»¤", "å…³é”®å‚æ•°": ["æ¾„æ˜åº¦"], "è®¾å¤‡": ["æ¿æ¡†è¿‡æ»¤å™¨"]},
                    {"name": "çŒè£…", "å…³é”®å‚æ•°": ["è£…é‡å·®å¼‚"], "è®¾å¤‡": ["æ¶²ä½“çŒè£…æœº"]},
                    {"name": "ç­èŒ", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æ—¶é—´"], "è®¾å¤‡": ["æ°´æµ´ç­èŒæŸœ"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°å®Œæ•´æ€§"], "è®¾å¤‡": ["æ—‹ç›–æœº"]}
                ]
            }
        },
        
        # 4. ç”Ÿç‰©åˆ¶å“
        "ç”Ÿç‰©åˆ¶å“": {
            "ç–«è‹—": {
                "description": "ç”¨äºé¢„é˜²ç–¾ç—…çš„ç”Ÿç‰©åˆ¶å“",
                "å…³é”®ç‰¹å¾": ["å…ç–«åŸæ€§", "å®‰å…¨æ€§", "ç¨³å®šæ€§"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "ç»†èƒåŸ¹å…»", "å…³é”®å‚æ•°": ["ç»†èƒå¯†åº¦", "æ´»åŠ›", "æ— èŒ"], "è®¾å¤‡": ["ç”Ÿç‰©ååº”å™¨"]},
                    {"name": "ç—…æ¯’æ¥ç§", "å…³é”®å‚æ•°": ["MOI", "æ„ŸæŸ“æ—¶é—´"], "è®¾å¤‡": ["æ— èŒæ“ä½œå°"]},
                    {"name": "ç—…æ¯’æ”¶è·", "å…³é”®å‚æ•°": ["ç—…æ¯’æ»´åº¦", "æ”¶è·æ—¶é—´"], "è®¾å¤‡": ["è¿ç»­æµç¦»å¿ƒæœº"]},
                    {"name": "çº¯åŒ–", "å…³é”®å‚æ•°": ["çº¯åº¦", "å›æ”¶ç‡"], "è®¾å¤‡": ["å±‚æç³»ç»Ÿ"]},
                    {"name": "ç­æ´»/å‡æ¯’", "å…³é”®å‚æ•°": ["ç­æ´»ç‡", "å…ç–«åŸæ€§"], "è®¾å¤‡": ["ç­æ´»ç½"]},
                    {"name": "é…åˆ¶", "å…³é”®å‚æ•°": ["æŠ—åŸå«é‡", "ä½å‰‚æ¯”ä¾‹"], "è®¾å¤‡": ["é…åˆ¶ç½"]},
                    {"name": "æ— èŒè¿‡æ»¤", "å…³é”®å‚æ•°": ["æ— èŒä¿è¯"], "è®¾å¤‡": ["é™¤èŒè¿‡æ»¤å™¨"]},
                    {"name": "çŒè£…", "å…³é”®å‚æ•°": ["çŒè£…ç²¾åº¦", "æ— èŒæ“ä½œ"], "è®¾å¤‡": ["éš”ç¦»å™¨çŒè£…çº¿"]},
                    {"name": "å†»å¹²", "å…³é”®å‚æ•°": ["æ°´åˆ†", "å¤–è§‚"], "è®¾å¤‡": ["å†·å†»å¹²ç‡¥æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å†·é“¾ç®¡ç†"], "è®¾å¤‡": ["è‡ªåŠ¨åŒ…è£…çº¿"]}
                ]
            },
            
            "å•å…‹éš†æŠ—ä½“": {
                "description": "ç”±å•ä¸€Bç»†èƒå…‹éš†äº§ç”Ÿçš„æŠ—ä½“",
                "å…³é”®ç‰¹å¾": ["é«˜ç‰¹å¼‚æ€§", "é«˜çº¯åº¦", "å·¥è‰ºå¤æ‚"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "ç»†èƒåº“å¤è‹", "å…³é”®å‚æ•°": ["ç»†èƒæ´»åŠ›", "æ— èŒ"], "è®¾å¤‡": ["æ¶²æ°®ç½"]},
                    {"name": "æ‘‡ç“¶åŸ¹å…»", "å…³é”®å‚æ•°": ["ç»†èƒå¯†åº¦", "æ´»åŠ›"], "è®¾å¤‡": ["æ‘‡åºŠ"]},
                    {"name": "ç”Ÿç‰©ååº”å™¨åŸ¹å…»", "å…³é”®å‚æ•°": ["DO", "pH", "ç»†èƒå¯†åº¦"], "è®¾å¤‡": ["ä¸é”ˆé’¢ç”Ÿç‰©ååº”å™¨"]},
                    {"name": "æ”¶è·", "å…³é”®å‚æ•°": ["æŠ—ä½“æµ“åº¦", "æ”¶è·æ—¶é—´"], "è®¾å¤‡": ["åˆ‡å‘æµè¿‡æ»¤ç³»ç»Ÿ"]},
                    {"name": "Protein Aäº²å’Œå±‚æ", "å…³é”®å‚æ•°": ["ç»“åˆå®¹é‡", "æ´—è„±æ¡ä»¶"], "è®¾å¤‡": ["AKTAå±‚æç³»ç»Ÿ"]},
                    {"name": "ä½pHç—…æ¯’ç­æ´»", "å…³é”®å‚æ•°": ["pHå€¼", "ç­æ´»æ—¶é—´"], "è®¾å¤‡": ["ç­æ´»ç½"]},
                    {"name": "ç¦»å­äº¤æ¢å±‚æ", "å…³é”®å‚æ•°": ["çº¯åº¦", "æ”¶ç‡"], "è®¾å¤‡": ["å±‚æç³»ç»Ÿ"]},
                    {"name": "è¶…æ»¤æµ“ç¼©", "å…³é”®å‚æ•°": ["æµ“åº¦", "æ”¶ç‡"], "è®¾å¤‡": ["åˆ‡å‘æµè¶…æ»¤ç³»ç»Ÿ"]},
                    {"name": "æ— èŒè¿‡æ»¤", "å…³é”®å‚æ•°": ["æ— èŒä¿è¯"], "è®¾å¤‡": ["é™¤èŒè¿‡æ»¤å™¨"]},
                    {"name": "çŒè£…", "å…³é”®å‚æ•°": ["çŒè£…ç²¾åº¦"], "è®¾å¤‡": ["è¥¿æ—ç“¶çŒè£…çº¿"]},
                    {"name": "å†»å¹²", "å…³é”®å‚æ•°": ["æ°´åˆ†", "å¤æº¶æ€§"], "è®¾å¤‡": ["å†·å†»å¹²ç‡¥æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°å®Œæ•´æ€§"], "è®¾å¤‡": ["è½§ç›–æœº"]}
                ]
            },
            
            "è¡€æ¶²åˆ¶å“": {
                "description": "ä»äººè¡€æµ†ä¸­åˆ†ç¦»åˆ¶å¤‡çš„æ²»ç–—æ€§è›‹ç™½",
                "å…³é”®ç‰¹å¾": ["åŸæ–™ç‰¹æ®Š", "ç—…æ¯’å®‰å…¨", "ç¨³å®šæ€§è¦æ±‚é«˜"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "è¡€æµ†èå†»", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æ—¶é—´"], "è®¾å¤‡": ["è¡€æµ†èå†»æœº"]},
                    {"name": "ä½æ¸©ä¹™é†‡åˆ†ç¦»", "å…³é”®å‚æ•°": ["ä¹™é†‡æµ“åº¦", "æ¸©åº¦", "pH"], "è®¾å¤‡": ["ä½æ¸©å†·åº“"]},
                    {"name": "ç¦»å¿ƒåˆ†ç¦»", "å…³é”®å‚æ•°": ["ç¦»å¿ƒåŠ›", "æ—¶é—´"], "è®¾å¤‡": ["è¿ç»­æµç¦»å¿ƒæœº"]},
                    {"name": "è¶…æ»¤æµ“ç¼©", "å…³é”®å‚æ•°": ["åˆ†å­é‡æˆªç•™", "æµ“ç¼©å€æ•°"], "è®¾å¤‡": ["ä¸­ç©ºçº¤ç»´è¶…æ»¤"]},
                    {"name": "å·´æ°æ¶ˆæ¯’", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æ—¶é—´"], "è®¾å¤‡": ["æ°´æµ´å·´æ°æ¶ˆæ¯’æŸœ"]},
                    {"name": "å±‚æçº¯åŒ–", "å…³é”®å‚æ•°": ["çº¯åº¦", "ç‰¹å¼‚æ€§"], "è®¾å¤‡": ["å±‚æç³»ç»Ÿ"]},
                    {"name": "é™¤èŒè¿‡æ»¤", "å…³é”®å‚æ•°": ["è¿‡æ»¤å™¨å®Œæ•´æ€§"], "è®¾å¤‡": ["é™¤èŒè¿‡æ»¤å™¨"]},
                    {"name": "çŒè£…", "å…³é”®å‚æ•°": ["çŒè£…ç²¾åº¦"], "è®¾å¤‡": ["çŒè£…çº¿"]},
                    {"name": "å‹å¡è½§ç›–", "å…³é”®å‚æ•°": ["å¯†å°æ€§"], "è®¾å¤‡": ["è½§ç›–æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å†·é“¾ç®¡ç†"], "è®¾å¤‡": ["è‡ªåŠ¨åŒ…è£…æœº"]}
                ]
            }
        },
        
        # 5. ä¸­è¯åˆ¶å‰‚
        "ä¸­è¯åˆ¶å‰‚": {
            "ä¸­è¯ç‰‡å‰‚": {
                "description": "ä¸­è¯æå–ç‰©ä¸è¾…æ–™å‹åˆ¶è€Œæˆçš„ç‰‡å‰‚",
                "å…³é”®ç‰¹å¾": ["æºå¸¦æ–¹ä¾¿", "å‰‚é‡å‡†ç¡®", "è´¨é‡ç¨³å®š"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "è¯æå‰å¤„ç†", "å…³é”®å‚æ•°": ["å‡€é€‰", "åˆ‡å‰²è§„æ ¼"], "è®¾å¤‡": ["æ´—è¯æœº", "åˆ‡è¯æœº"]},
                    {"name": "æå–", "å…³é”®å‚æ•°": ["æº¶å‰‚", "æ¸©åº¦", "æ—¶é—´"], "è®¾å¤‡": ["å¤šåŠŸèƒ½æå–ç½"]},
                    {"name": "æµ“ç¼©", "å…³é”®å‚æ•°": ["ç›¸å¯¹å¯†åº¦", "æ¸©åº¦"], "è®¾å¤‡": ["çœŸç©ºæµ“ç¼©å™¨"]},
                    {"name": "å¹²ç‡¥", "å…³é”®å‚æ•°": ["æ°´åˆ†", "ç²’åº¦"], "è®¾å¤‡": ["å–·é›¾å¹²ç‡¥å¡”"]},
                    {"name": "ç²‰ç¢è¿‡ç­›", "å…³é”®å‚æ•°": ["ç²’åº¦åˆ†å¸ƒ"], "è®¾å¤‡": ["ç²‰ç¢æœº", "æŒ¯è¡ç­›"]},
                    {"name": "åˆ¶ç²’", "å…³é”®å‚æ•°": ["é¢—ç²’æ€§çŠ¶", "æ°´åˆ†"], "è®¾å¤‡": ["æ¹¿æ³•åˆ¶ç²’æœº"]},
                    {"name": "å‹ç‰‡", "å…³é”®å‚æ•°": ["ç‰‡é‡å·®å¼‚", "ç¡¬åº¦"], "è®¾å¤‡": ["æ—‹è½¬å‹ç‰‡æœº"]},
                    {"name": "åŒ…è¡£", "å…³é”®å‚æ•°": ["å¢é‡", "å¤–è§‚"], "è®¾å¤‡": ["é«˜æ•ˆåŒ…è¡£é”…"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°é˜²æ½®"], "è®¾å¤‡": ["é“å¡‘åŒ…è£…æœº"]}
                ]
            },
            
            "ä¸­è¯æ³¨å°„å‰‚": {
                "description": "ä¸­è¯æå–ç‰©åˆ¶æˆçš„ä¾›æ³¨å°„ç”¨çš„ç­èŒåˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["èµ·æ•ˆå¿«", "è´¨é‡è¦æ±‚é«˜", "å·¥è‰ºå¤æ‚"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "è¯ææå–", "å…³é”®å‚æ•°": ["æå–ç‡"], "è®¾å¤‡": ["åŠ¨æ€æå–ç½"]},
                    {"name": "é†‡æ²‰", "å…³é”®å‚æ•°": ["ä¹™é†‡æµ“åº¦", "æ²‰æ·€æ—¶é—´"], "è®¾å¤‡": ["é†‡æ²‰ç½"]},
                    {"name": "æ°´æ²‰", "å…³é”®å‚æ•°": ["æ²‰æ·€æ—¶é—´", "æ¸©åº¦"], "è®¾å¤‡": ["æ°´æ²‰ç½"]},
                    {"name": "è¶…æ»¤", "å…³é”®å‚æ•°": ["åˆ†å­é‡æˆªç•™"], "è®¾å¤‡": ["è¶…æ»¤ç³»ç»Ÿ"]},
                    {"name": "å¸é™„çº¯åŒ–", "å…³é”®å‚æ•°": ["å¸é™„å®¹é‡", "æ´—è„±æ¡ä»¶"], "è®¾å¤‡": ["å¸é™„æŸ±"]},
                    {"name": "é…æ¶²", "å…³é”®å‚æ•°": ["pHå€¼", "æ¾„æ˜åº¦"], "è®¾å¤‡": ["é…æ¶²ç½"]},
                    {"name": "é™¤èŒè¿‡æ»¤", "å…³é”®å‚æ•°": ["æ— èŒä¿è¯"], "è®¾å¤‡": ["é™¤èŒè¿‡æ»¤å™¨"]},
                    {"name": "çŒå°", "å…³é”®å‚æ•°": ["çŒè£…ç²¾åº¦"], "è®¾å¤‡": ["å®‰ç“¿çŒå°æœº"]},
                    {"name": "ç­èŒ", "å…³é”®å‚æ•°": ["F0å€¼"], "è®¾å¤‡": ["ç­èŒæŸœ"]},
                    {"name": "ç¯æ£€", "å…³é”®å‚æ•°": ["å¯è§å¼‚ç‰©"], "è®¾å¤‡": ["ç¯æ£€æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["æ ‡ç­¾å‡†ç¡®æ€§"], "è®¾å¤‡": ["è´´æ ‡æœº"]}
                ]
            }
        },
        
        # 6. æ–°å‹åˆ¶å‰‚
        "æ–°å‹åˆ¶å‰‚": {
            "è„‚è´¨ä½“": {
                "description": "è¯ç‰©åŒ…å°äºç±»è„‚è´¨åŒåˆ†å­å±‚ä¸­å½¢æˆçš„å¾®å‹æ³¡å›Š",
                "å…³é”®ç‰¹å¾": ["é¶å‘æ€§", "ç¼“é‡Šæ€§", "é™ä½æ¯’æ€§"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "è„‚è´¨è†œåˆ¶å¤‡", "å…³é”®å‚æ•°": ["ç£·è„‚æ¯”ä¾‹", "æˆè†œå‡åŒ€æ€§"], "è®¾å¤‡": ["æ—‹è½¬è’¸å‘ä»ª"]},
                    {"name": "æ°´åŒ–", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æ°´åŒ–æ—¶é—´"], "è®¾å¤‡": ["æ°´æµ´è¶…å£°ä»ª"]},
                    {"name": "è½½è¯", "å…³é”®å‚æ•°": ["åŒ…å°ç‡", "è½½è¯é‡"], "è®¾å¤‡": ["è½½è¯è£…ç½®"]},
                    {"name": "æŒ¤å‡ºå‡è´¨", "å…³é”®å‚æ•°": ["å‹åŠ›", "å¾ªç¯æ¬¡æ•°", "ç²’å¾„"], "è®¾å¤‡": ["æŒ¤å‡ºå™¨"]},
                    {"name": "çº¯åŒ–", "å…³é”®å‚æ•°": ["åˆ†ç¦»æ•ˆç‡"], "è®¾å¤‡": ["æŸ±å±‚æç³»ç»Ÿ"]},
                    {"name": "é™¤èŒè¿‡æ»¤", "å…³é”®å‚æ•°": ["æ— èŒä¿è¯"], "è®¾å¤‡": ["0.22Î¼mæ»¤å™¨"]},
                    {"name": "çŒè£…", "å…³é”®å‚æ•°": ["çŒè£…ç²¾åº¦"], "è®¾å¤‡": ["çŒè£…æœº"]},
                    {"name": "å†»å¹²", "å…³é”®å‚æ•°": ["å†»å¹²æ›²çº¿", "å¤æº¶æ€§"], "è®¾å¤‡": ["å†·å†»å¹²ç‡¥æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°æ€§"], "è®¾å¤‡": ["è½§ç›–æœº"]}
                ]
            },
            
            "é€çš®è´´å‰‚": {
                "description": "è¯ç‰©é€šè¿‡çš®è‚¤å¸æ”¶è¿›å…¥å…¨èº«å¾ªç¯çš„åˆ¶å‰‚",
                "å…³é”®ç‰¹å¾": ["é¿å…é¦–è¿‡æ•ˆåº”", "è¡€è¯æµ“åº¦ç¨³å®š", "ä½¿ç”¨æ–¹ä¾¿"],
                "å·¥è‰ºæ­¥éª¤": [
                    {"name": "è¯ç‰©å¤„ç†", "å…³é”®å‚æ•°": ["ç²’åº¦", "æº¶è§£åº¦"], "è®¾å¤‡": ["ç²‰ç¢æœº"]},
                    {"name": "å‹æ•èƒ¶åˆ¶å¤‡", "å…³é”®å‚æ•°": ["ç²˜åº¦", "ç²˜é™„åŠ›"], "è®¾å¤‡": ["æ…æ‹Œæœº"]},
                    {"name": "è¯ç‰©æ··åˆ", "å…³é”®å‚æ•°": ["æ··åˆå‡åŒ€åº¦"], "è®¾å¤‡": ["è¡Œæ˜Ÿæ…æ‹Œæœº"]},
                    {"name": "æ¶‚å¸ƒ", "å…³é”®å‚æ•°": ["æ¶‚å¸ƒåšåº¦", "å‡åŒ€åº¦"], "è®¾å¤‡": ["æ¶‚å¸ƒæœº"]},
                    {"name": "å¹²ç‡¥", "å…³é”®å‚æ•°": ["æ¸©åº¦", "æ—¶é—´", "æ®‹ç•™æº¶å‰‚"], "è®¾å¤‡": ["å¹²ç‡¥éš§é“"]},
                    {"name": "å¤åˆèƒŒè¡¬", "å…³é”®å‚æ•°": ["å¤åˆå¼ºåº¦"], "è®¾å¤‡": ["å¤åˆæœº"]},
                    {"name": "åˆ‡å‰²", "å…³é”®å‚æ•°": ["å°ºå¯¸ç²¾åº¦"], "è®¾å¤‡": ["æ¨¡åˆ‡æœº"]},
                    {"name": "åŒ…è£…", "å…³é”®å‚æ•°": ["å¯†å°æ€§"], "è®¾å¤‡": ["é“ç®”è¢‹åŒ…è£…æœº"]}
                ]
            }
        }
    }
    
    # è·å–æ‰€æœ‰ä¸»åˆ†ç±»
    @staticmethod
    def get_main_categories():
        return list(PharmaceuticalProcesses.PROCESSES.keys())
    
    # è·å–å­åˆ†ç±»ï¼ˆäº§å“ï¼‰
    @staticmethod
    def get_products(main_category):
        return list(PharmaceuticalProcesses.PROCESSES.get(main_category, {}).keys())
    
    # è·å–äº§å“ä¿¡æ¯
    @staticmethod
    def get_product_info(main_category, product):
        return PharmaceuticalProcesses.PROCESSES.get(main_category, {}).get(product, {})
    
    # è·å–æ‰€æœ‰äº§å“çš„æ¯”è¾ƒæ•°æ®
    @staticmethod
    def get_comparison_data(selected_products):
        """è·å–å¤šä¸ªäº§å“çš„å¯¹æ¯”æ•°æ®"""
        comparison_data = []
        
        for product_path in selected_products:
            parts = product_path.split(" | ")
            if len(parts) == 2:
                main_cat, product = parts
                info = PharmaceuticalProcesses.get_product_info(main_cat, product)
                if info:
                    # è®¡ç®—å·¥è‰ºå¤æ‚åº¦ï¼ˆæ­¥éª¤æ•°ï¼‰
                    complexity = len(info.get("å·¥è‰ºæ­¥éª¤", []))
                    
                    # ä¼°ç®—ç”Ÿäº§å‘¨æœŸï¼ˆåŸºäºæ­¥éª¤æ•°ï¼‰
                    cycle_days = complexity * 0.5  # å‡è®¾æ¯ä¸ªæ­¥éª¤0.5å¤©
                    
                    # ä¼°ç®—æˆæœ¬æŒ‡æ•°
                    cost_index = complexity * 10
                    
                    # ä¼°ç®—è´¨é‡è¦æ±‚æŒ‡æ•°
                    quality_index = 0
                    steps = info.get("å·¥è‰ºæ­¥éª¤", [])
                    for step in steps:
                        quality_index += len(step.get("å…³é”®å‚æ•°", []))
                    
                    comparison_data.append({
                        "äº§å“åç§°": product,
                        "æ‰€å±åˆ†ç±»": main_cat,
                        "æè¿°": info.get("description", ""),
                        "å·¥è‰ºæ­¥éª¤æ•°": complexity,
                        "ä¼°ç®—ç”Ÿäº§å‘¨æœŸ(å¤©)": round(cycle_days, 1),
                        "æˆæœ¬æŒ‡æ•°": cost_index,
                        "è´¨é‡è¦æ±‚æŒ‡æ•°": quality_index,
                        "å…³é”®ç‰¹å¾": ", ".join(info.get("å…³é”®ç‰¹å¾", [])),
                        "ä¸»è¦è®¾å¤‡æ•°": len(set([equip for step in steps for equip in step.get("è®¾å¤‡", [])]))
                    })
        
        return pd.DataFrame(comparison_data)

# è¾…åŠ©æ–¹æ³•
def classify_parameter(param_name):
    """å‚æ•°åˆ†ç±»"""
    param_lower = param_name.lower()
    
    if any(word in param_lower for word in ['æ¸©åº¦', 'å‹åŠ›', 'ph', 'æµ“åº¦']):
        return "ç‰©ç†åŒ–å­¦å‚æ•°"
    elif any(word in param_lower for word in ['æ—¶é—´', 'é€Ÿç‡', 'é€Ÿåº¦']):
        return "è¿‡ç¨‹æ§åˆ¶å‚æ•°"
    elif any(word in param_lower for word in ['å«é‡', 'çº¯åº¦', 'æ‚è´¨']):
        return "è´¨é‡å‚æ•°"
    elif any(word in param_lower for word in ['æ”¶ç‡', 'æ•ˆç‡', 'äº§é‡']):
        return "ç»æµæ€§å‚æ•°"
    else:
        return "å…¶ä»–å‚æ•°"

def assess_importance(param_name):
    """è¯„ä¼°å‚æ•°é‡è¦ç¨‹åº¦"""
    param_lower = param_name.lower()
    
    if any(word in param_lower for word in ['æ— èŒ', 'ç­èŒ', 'ç—…æ¯’', 'å®‰å…¨']):
        return 5  # æœ€é«˜é‡è¦æ€§
    elif any(word in param_lower for word in ['å«é‡', 'çº¯åº¦', 'å…³é”®è´¨é‡']):
        return 4
    elif any(word in param_lower for word in ['æ¸©åº¦', 'æ—¶é—´', 'ph']):
        return 3
    else:
        return 2

def classify_equipment(equip_name):
    """è®¾å¤‡åˆ†ç±»"""
    equip_lower = equip_name.lower()
    
    if any(word in equip_lower for word in ['ååº”å™¨', 'å‘é…µç½', 'ç”Ÿç‰©']):
        return "ç”Ÿç‰©ååº”è®¾å¤‡"
    elif any(word in equip_lower for word in ['ç¦»å¿ƒ', 'è¿‡æ»¤', 'å±‚æ', 'çº¯åŒ–']):
        return "åˆ†ç¦»çº¯åŒ–è®¾å¤‡"
    elif any(word in equip_lower for word in ['å¹²ç‡¥', 'æµ“ç¼©', 'è’¸å‘']):
        return "å¹²ç‡¥æµ“ç¼©è®¾å¤‡"
    elif any(word in equip_lower for word in ['æ··åˆ', 'æ…æ‹Œ', 'åˆ¶ç²’']):
        return "æ··åˆåˆ¶å¤‡è®¾å¤‡"
    elif any(word in equip_lower for word in ['çŒè£…', 'åŒ…è£…', 'è´´æ ‡']):
        return "çŒè£…åŒ…è£…è®¾å¤‡"
    elif any(word in equip_lower for word in ['ç­èŒ', 'æ¶ˆæ¯’']):
        return "ç­èŒæ¶ˆæ¯’è®¾å¤‡"
    else:
        return "å…¶ä»–è®¾å¤‡"

# ä¾§è¾¹æ é…ç½®
with st.sidebar:
    st.header("âš™ï¸ é…ç½®é€‰é¡¹")
    
    # é€‰æ‹©æ¨¡å¼
    mode = st.radio(
        "é€‰æ‹©æŸ¥çœ‹æ¨¡å¼",
        ["å•ä¸€äº§å“è¯¦æƒ…", "å¤šäº§å“å¯¹æ¯”", "åˆ†ç±»æ¦‚è§ˆ"],
        index=0
    )
    
    st.markdown("---")
    
    if mode == "å•ä¸€äº§å“è¯¦æƒ…":
        st.subheader("é€‰æ‹©äº§å“")
        
        # é€‰æ‹©ä¸»åˆ†ç±»
        main_categories = PharmaceuticalProcesses.get_main_categories()
        selected_main = st.selectbox(
            "é€‰æ‹©è¯å“ä¸»åˆ†ç±»",
            main_categories,
            index=0
        )
        
        # é€‰æ‹©å…·ä½“äº§å“
        if selected_main:
            products = PharmaceuticalProcesses.get_products(selected_main)
            selected_product = st.selectbox(
                "é€‰æ‹©å…·ä½“äº§å“",
                products,
                index=0
            )
            
            # æ˜¾ç¤ºäº§å“åŸºæœ¬ä¿¡æ¯
            product_info = PharmaceuticalProcesses.get_product_info(selected_main, selected_product)
            if product_info:
                with st.expander("ğŸ“ äº§å“ç®€ä»‹"):
                    st.write(f"**æè¿°**: {product_info.get('description', '')}")
                    st.write("**å…³é”®ç‰¹å¾**:")
                    for feature in product_info.get("å…³é”®ç‰¹å¾", []):
                        st.write(f"- {feature}")
    
    elif mode == "å¤šäº§å“å¯¹æ¯”":
        st.subheader("é€‰æ‹©å¯¹æ¯”äº§å“")
        
        # æ„å»ºæ‰€æœ‰äº§å“é€‰é¡¹åˆ—è¡¨
        all_products = []
        for main_cat in PharmaceuticalProcesses.get_main_categories():
            for product in PharmaceuticalProcesses.get_products(main_cat):
                all_products.append(f"{main_cat} | {product}")
        
        # å¤šé€‰äº§å“
        selected_comparison = st.multiselect(
            "é€‰æ‹©è¦å¯¹æ¯”çš„äº§å“ï¼ˆæœ€å¤š6ä¸ªï¼‰",
            all_products,
            default=all_products[:3] if len(all_products) >= 3 else all_products
        )
        
        # é™åˆ¶é€‰æ‹©æ•°é‡
        if len(selected_comparison) > 6:
            st.warning("æœ€å¤šé€‰æ‹©6ä¸ªäº§å“è¿›è¡Œå¯¹æ¯”")
            selected_comparison = selected_comparison[:6]
    
    else:  # åˆ†ç±»æ¦‚è§ˆ
        st.subheader("åˆ†ç±»æ¦‚è§ˆè®¾ç½®")
        
        overview_type = st.selectbox(
            "æ¦‚è§ˆç±»å‹",
            ["å·¥è‰ºæ­¥éª¤æ•°å¯¹æ¯”", "å·¥è‰ºå¤æ‚åº¦é›·è¾¾å›¾", "è®¾å¤‡éœ€æ±‚å¯¹æ¯”"]
        )
    
    st.markdown("---")
    st.caption("ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä¸åŒæ ‡ç­¾é¡µæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯")

# ä¸»æ˜¾ç¤ºåŒºåŸŸ
if mode == "å•ä¸€äº§å“è¯¦æƒ…":
    if 'selected_main' in locals() and 'selected_product' in locals():
        product_info = PharmaceuticalProcesses.get_product_info(selected_main, selected_product)
        
        if product_info:
            # äº§å“æ ‡é¢˜
            st.header(f"ğŸ”¬ {selected_product} ç”Ÿäº§å·¥è‰ºæµç¨‹")
            st.caption(f"æ‰€å±åˆ†ç±»: {selected_main}")
            
            # åˆ›å»ºæ ‡ç­¾é¡µ
            tab1, tab2, tab3, tab4 = st.tabs([
                "ğŸ“‹ å·¥è‰ºæ­¥éª¤è¯¦æƒ…", 
                "ğŸ”§ å…³é”®å‚æ•°åˆ†æ", 
                "ğŸ­ è®¾å¤‡éœ€æ±‚", 
                "ğŸ“Š å·¥è‰ºæµç¨‹å›¾"
            ])
            
            with tab1:
                st.subheader("å·¥è‰ºæ­¥éª¤è¯¦è§£")
                
                steps = product_info.get("å·¥è‰ºæ­¥éª¤", [])
                
                for i, step in enumerate(steps, 1):
                    with st.expander(f"æ­¥éª¤{i}: {step['name']}", expanded=(i==1)):
                        col1, col2, col3 = st.columns([2, 2, 1])
                        
                        with col1:
                            st.markdown("**å…³é”®å‚æ•°:**")
                            for param in step.get("å…³é”®å‚æ•°", []):
                                st.write(f"â€¢ {param}")
                        
                        with col2:
                            st.markdown("**ä¸»è¦è®¾å¤‡:**")
                            for equip in step.get("è®¾å¤‡", []):
                                st.write(f"â€¢ {equip}")
                        
                        with col3:
                            # æ­¥éª¤ç‰¹æ€§æ ‡è¯†
                            step_type = "å…³é”®æ­¥éª¤" if i in [1, len(steps)//2, len(steps)] else "å¸¸è§„æ­¥éª¤"
                            color = "red" if step_type == "å…³é”®æ­¥éª¤" else "blue"
                            st.markdown(f"""
                            <div style="
                                background-color: {color}20; 
                                padding: 8px; 
                                border-radius: 5px; 
                                border-left: 4px solid {color};
                                margin-top: 10px;
                            ">
                                <p style="margin: 0; font-size: 0.9em; color: {color};">
                                    <b>{step_type}</b>
                                </p>
                            </div>
                            """, unsafe_allow_html=True)
                
                # å·¥è‰ºç»Ÿè®¡
                st.subheader("å·¥è‰ºç»Ÿè®¡")
                col1, col2, col3, col4 = st.columns(4)
                
                with col1:
                    st.metric("æ€»æ­¥éª¤æ•°", len(steps))
                
                with col2:
                    # è®¡ç®—å…³é”®å‚æ•°æ€»æ•°
                    total_params = sum(len(step.get("å…³é”®å‚æ•°", [])) for step in steps)
                    st.metric("å…³é”®å‚æ•°æ€»æ•°", total_params)
                
                with col3:
                    # è®¡ç®—è®¾å¤‡æ€»æ•°ï¼ˆå»é‡ï¼‰
                    all_equipment = set()
                    for step in steps:
                        all_equipment.update(step.get("è®¾å¤‡", []))
                    st.metric("è®¾å¤‡ç§ç±»æ•°", len(all_equipment))
                
                with col4:
                    # ä¼°ç®—å¤æ‚åº¦
                    complexity_score = len(steps) * 2 + total_params
                    st.metric("å¤æ‚åº¦æŒ‡æ•°", complexity_score)
            
            with tab2:
                st.subheader("å…³é”®å‚æ•°åˆ†æ")
                
                steps = product_info.get("å·¥è‰ºæ­¥éª¤", [])
                all_params = []
                
                for step in steps:
                    for param in step.get("å…³é”®å‚æ•°", []):
                        all_params.append({
                            "å‚æ•°åç§°": param,
                            "æ‰€å±æ­¥éª¤": step["name"],
                            "å‚æ•°ç±»å‹": classify_parameter(param),
                            "é‡è¦ç¨‹åº¦": assess_importance(param)
                        })
                
                if all_params:
                    params_df = pd.DataFrame(all_params)
                    
                    # å‚æ•°åˆ†ç±»ç»Ÿè®¡
                    st.write("### å‚æ•°åˆ†ç±»ç»Ÿè®¡")
                    param_counts = params_df["å‚æ•°ç±»å‹"].value_counts()
                    
                    fig1 = px.pie(
                        values=param_counts.values,
                        names=param_counts.index,
                        title="å…³é”®å‚æ•°ç±»å‹åˆ†å¸ƒ"
                    )
                    st.plotly_chart(fig1, use_container_width=True)
                    
                    # å‚æ•°è¯¦æƒ…è¡¨æ ¼
                    st.write("### å‚æ•°è¯¦æƒ…")
                    st.dataframe(
                        params_df,
                        column_config={
                            "å‚æ•°åç§°": st.column_config.TextColumn("å‚æ•°åç§°"),
                            "æ‰€å±æ­¥éª¤": st.column_config.TextColumn("æ‰€å±æ­¥éª¤"),
                            "å‚æ•°ç±»å‹": st.column_config.TextColumn(
                                "å‚æ•°ç±»å‹",
                                help="æ ¹æ®å‚æ•°æ€§è´¨åˆ†ç±»"
                            ),
                            "é‡è¦ç¨‹åº¦": st.column_config.ProgressColumn(
                                "é‡è¦ç¨‹åº¦",
                                help="å‚æ•°çš„é‡è¦ç¨‹åº¦è¯„åˆ†",
                                min_value=1,
                                max_value=5
                            )
                        },
                        use_container_width=True
                    )
            
            with tab3:
                st.subheader("è®¾å¤‡éœ€æ±‚åˆ†æ")
                
                steps = product_info.get("å·¥è‰ºæ­¥éª¤", [])
                equipment_data = []
                
                for step in steps:
                    for equip in step.get("è®¾å¤‡", []):
                        equipment_data.append({
                            "è®¾å¤‡åç§°": equip,
                            "ä½¿ç”¨æ­¥éª¤": step["name"],
                            "è®¾å¤‡ç±»å‹": classify_equipment(equip),
                            "ä½¿ç”¨é¢‘ç‡": 1
                        })
                
                if equipment_data:
                    equip_df = pd.DataFrame(equipment_data)
                    
                    # è®¾å¤‡ä½¿ç”¨ç»Ÿè®¡
                    st.write("### è®¾å¤‡ä½¿ç”¨æƒ…å†µ")
                    
                    # æŒ‰è®¾å¤‡ç±»å‹ç»Ÿè®¡
                    equip_type_counts = equip_df["è®¾å¤‡ç±»å‹"].value_counts()
                    
                    fig2 = px.bar(
                        x=equip_type_counts.index,
                        y=equip_type_counts.values,
                        title="è®¾å¤‡ç±»å‹åˆ†å¸ƒ",
                        labels={"x": "è®¾å¤‡ç±»å‹", "y": "ä½¿ç”¨æ¬¡æ•°"}
                    )
                    st.plotly_chart(fig2, use_container_width=True)
                    
                    # è¯¦ç»†è®¾å¤‡åˆ—è¡¨
                    st.write("### è¯¦ç»†è®¾å¤‡æ¸…å•")
                    
                    # æ±‡æ€»é‡å¤è®¾å¤‡
                    equip_summary = equip_df.groupby("è®¾å¤‡åç§°").agg({
                        "è®¾å¤‡ç±»å‹": "first",
                        "ä½¿ç”¨é¢‘ç‡": "sum",
                        "ä½¿ç”¨æ­¥éª¤": lambda x: ", ".join(x)
                    }).reset_index()
                    
                    st.dataframe(
                        equip_summary,
                        column_config={
                            "è®¾å¤‡åç§°": st.column_config.TextColumn("è®¾å¤‡åç§°"),
                            "è®¾å¤‡ç±»å‹": st.column_config.TextColumn("è®¾å¤‡ç±»å‹"),
                            "ä½¿ç”¨é¢‘ç‡": st.column_config.NumberColumn(
                                "ä½¿ç”¨æ¬¡æ•°",
                                help="åœ¨å·¥è‰ºä¸­ä½¿ç”¨çš„æ€»æ¬¡æ•°"
                            ),
                            "ä½¿ç”¨æ­¥éª¤": st.column_config.TextColumn(
                                "ä½¿ç”¨æ­¥éª¤",
                                help="ä½¿ç”¨è¯¥è®¾å¤‡çš„å·¥è‰ºæ­¥éª¤",
                                width="large"
                            )
                        },
                        use_container_width=True
                    )
            
            with tab4:
                st.subheader("å·¥è‰ºæµç¨‹å›¾")
                
                steps = product_info.get("å·¥è‰ºæ­¥éª¤", [])
                
                # ä½¿ç”¨Plotlyåˆ›å»ºæµç¨‹å›¾
                fig = go.Figure()
                
                # è®¡ç®—èŠ‚ç‚¹ä½ç½®
                y_positions = [0.5] * len(steps)  # æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ°´å¹³çº¿
                x_positions = [i/(len(steps)-1) if len(steps) > 1 else 0.5 for i in range(len(steps))]
                
                # æ·»åŠ èŠ‚ç‚¹
                for i, step in enumerate(steps):
                    step_info = step
                    fig.add_trace(go.Scatter(
                        x=[x_positions[i]],
                        y=[y_positions[i]],
                        mode="markers+text",
                        marker=dict(
                            size=30,
                            color="lightblue",
                            line=dict(width=2, color="darkblue")
                        ),
                        text=f"{i+1}. {step['name']}",
                        textposition="middle center",
                        name=step['name'],
                        hoverinfo="text",
                        hovertext=f"å…³é”®å‚æ•°: {', '.join(step.get('å…³é”®å‚æ•°', []))}"
                    ))
                
                # æ·»åŠ è¿æ¥çº¿
                for i in range(len(steps)-1):
                    fig.add_trace(go.Scatter(
                        x=[x_positions[i] + 0.05, x_positions[i+1] - 0.05],
                        y=[y_positions[i], y_positions[i+1]],
                        mode="lines",
                        line=dict(width=2, color="gray", dash="dash"),
                        hoverinfo="none",
                        showlegend=False
                    ))
                    
                    # æ·»åŠ ç®­å¤´
                    mid_x = (x_positions[i] + x_positions[i+1]) / 2
                    fig.add_annotation(
                        x=mid_x,
                        y=0.5,
                        ax=mid_x - 0.02,
                        ay=0.5,
                        xref="x",
                        yref="y",
                        axref="x",
                        ayref="y",
                        showarrow=True,
                        arrowhead=2,
                        arrowsize=1,
                        arrowwidth=2,
                        arrowcolor="gray"
                    )
                
                # æ›´æ–°å¸ƒå±€
                fig.update_layout(
                    title=f"{selected_product} å·¥è‰ºæµç¨‹å›¾",
                    height=300,
                    showlegend=False,
                    xaxis=dict(
                        showgrid=False,
                        zeroline=False,
                        showticklabels=False,
                        range=[-0.1, 1.1]
                    ),
                    yaxis=dict(
                        showgrid=False,
                        zeroline=False,
                        showticklabels=False,
                        range=[0, 1]
                    ),
                    plot_bgcolor="white",
                    margin=dict(l=20, r=20, t=40, b=20)
                )
                
                st.plotly_chart(fig, use_container_width=True)
                
                # æµç¨‹å›¾è¯´æ˜
                st.info("""
                **æµç¨‹å›¾è¯´æ˜:**
                - æ¯ä¸ªæ–¹å—ä»£è¡¨ä¸€ä¸ªå·¥è‰ºæ­¥éª¤
                - æ–¹å—ç¼–å·è¡¨ç¤ºæ­¥éª¤é¡ºåº
                - ç®­å¤´è¡¨ç¤ºå·¥è‰ºæµå‘
                - æ‚¬åœæŸ¥çœ‹æ¯ä¸ªæ­¥éª¤çš„å…³é”®å‚æ•°
                """)
    
    else:
        st.info("è¯·åœ¨ä¾§è¾¹æ é€‰æ‹©äº§å“å’Œåˆ†ç±»")

elif mode == "å¤šäº§å“å¯¹æ¯”":
    st.header("ğŸ“Š å¤šäº§å“å·¥è‰ºå¯¹æ¯”åˆ†æ")
    
    if 'selected_comparison' in locals() and selected_comparison:
        # è·å–å¯¹æ¯”æ•°æ®
        comparison_df = PharmaceuticalProcesses.get_comparison_data(selected_comparison)
        
        if not comparison_df.empty:
            # æ˜¾ç¤ºå¯¹æ¯”è¡¨æ ¼
            st.subheader("äº§å“åŸºæœ¬ä¿¡æ¯å¯¹æ¯”")
            st.dataframe(
                comparison_df,
                column_config={
                    "äº§å“åç§°": st.column_config.TextColumn("äº§å“åç§°"),
                    "æ‰€å±åˆ†ç±»": st.column_config.TextColumn("æ‰€å±åˆ†ç±»"),
                    "å·¥è‰ºæ­¥éª¤æ•°": st.column_config.NumberColumn(
                        "å·¥è‰ºæ­¥éª¤æ•°",
                        help="ç”Ÿäº§å·¥è‰ºçš„æ€»æ­¥éª¤æ•°"
                    ),
                    "ä¼°ç®—ç”Ÿäº§å‘¨æœŸ(å¤©)": st.column_config.NumberColumn(
                        "ç”Ÿäº§å‘¨æœŸ(å¤©)",
                        help="ä¼°ç®—çš„ç”Ÿäº§å‘¨æœŸ",
                        format="%.1f"
                    ),
                    "æˆæœ¬æŒ‡æ•°": st.column_config.NumberColumn(
                        "æˆæœ¬æŒ‡æ•°",
                        help="ç›¸å¯¹æˆæœ¬æŒ‡æ•°"
                    ),
                    "è´¨é‡è¦æ±‚æŒ‡æ•°": st.column_config.NumberColumn(
                        "è´¨é‡è¦æ±‚æŒ‡æ•°",
                        help="è´¨é‡æ§åˆ¶çš„å¤æ‚ç¨‹åº¦"
                    ),
                    "ä¸»è¦è®¾å¤‡æ•°": st.column_config.NumberColumn("ä¸»è¦è®¾å¤‡æ•°")
                },
                use_container_width=True,
                hide_index=True
            )
            
            # åˆ›å»ºå¯¹æ¯”æ ‡ç­¾é¡µ
            tab1, tab2, tab3 = st.tabs(["ğŸ“ˆ å·¥è‰ºå¤æ‚åº¦å¯¹æ¯”", "ğŸ¯ é›·è¾¾å›¾å¯¹æ¯”", "ğŸ” è¯¦ç»†æ­¥éª¤å¯¹æ¯”"])
            
            with tab1:
                # å·¥è‰ºæ­¥éª¤æ•°å¯¹æ¯”æŸ±çŠ¶å›¾
                fig1 = px.bar(
                    comparison_df,
                    x="äº§å“åç§°",
                    y="å·¥è‰ºæ­¥éª¤æ•°",
                    color="æ‰€å±åˆ†ç±»",
                    title="å„äº§å“å·¥è‰ºæ­¥éª¤æ•°å¯¹æ¯”",
                    text="å·¥è‰ºæ­¥éª¤æ•°",
                    hover_data=["æè¿°"]
                )
                
                fig1.update_traces(textposition='outside')
                fig1.update_layout(
                    xaxis_title="äº§å“åç§°",
                    yaxis_title="å·¥è‰ºæ­¥éª¤æ•°",
                    showlegend=True
                )
                
                st.plotly_chart(fig1, use_container_width=True)
                
                # æˆæœ¬ä¸è´¨é‡è¦æ±‚æ•£ç‚¹å›¾
                fig2 = px.scatter(
                    comparison_df,
                    x="æˆæœ¬æŒ‡æ•°",
                    y="è´¨é‡è¦æ±‚æŒ‡æ•°",
                    size="å·¥è‰ºæ­¥éª¤æ•°",
                    color="æ‰€å±åˆ†ç±»",
                    text="äº§å“åç§°",
                    title="æˆæœ¬ä¸è´¨é‡è¦æ±‚å…³ç³»åˆ†æ",
                    hover_data=["ä¼°ç®—ç”Ÿäº§å‘¨æœŸ(å¤©)"]
                )
                
                fig2.update_traces(textposition='top center')
                fig2.update_layout(
                    xaxis_title="æˆæœ¬æŒ‡æ•°",
                    yaxis_title="è´¨é‡è¦æ±‚æŒ‡æ•°"
                )
                
                st.plotly_chart(fig2, use_container_width=True)
            
            with tab2:
                st.subheader("å¤šç»´åº¦é›·è¾¾å›¾å¯¹æ¯”")
                
                # é€‰æ‹©ç”¨äºé›·è¾¾å›¾çš„æŒ‡æ ‡
                radar_metrics = st.multiselect(
                    "é€‰æ‹©é›·è¾¾å›¾æŒ‡æ ‡",
                    ["å·¥è‰ºæ­¥éª¤æ•°", "æˆæœ¬æŒ‡æ•°", "è´¨é‡è¦æ±‚æŒ‡æ•°", "ä¸»è¦è®¾å¤‡æ•°", "ä¼°ç®—ç”Ÿäº§å‘¨æœŸ(å¤©)"],
                    default=["å·¥è‰ºæ­¥éª¤æ•°", "æˆæœ¬æŒ‡æ•°", "è´¨é‡è¦æ±‚æŒ‡æ•°", "ä¸»è¦è®¾å¤‡æ•°"]
                )
                
                if len(radar_metrics) >= 3:
                    # å‡†å¤‡é›·è¾¾å›¾æ•°æ®
                    radar_data = []
                    
                    for idx, row in comparison_df.iterrows():
                        values = []
                        for metric in radar_metrics:
                            values.append(row[metric])
                        
                        # æ ‡å‡†åŒ–æ•°æ®ï¼ˆ0-1èŒƒå›´ï¼‰
                        max_val = comparison_df[metric].max()
                        min_val = comparison_df[metric].min()
                        if max_val > min_val:
                            normalized_values = [(v - min_val) / (max_val - min_val) for v in values]
                        else:
                            normalized_values = [0.5 for _ in values]
                        
                        radar_data.append(go.Scatterpolar(
                            r=normalized_values + [normalized_values[0]],  # é—­åˆå›¾å½¢
                            theta=radar_metrics + [radar_metrics[0]],
                            fill='toself',
                            name=f"{row['äº§å“åç§°']} ({row['æ‰€å±åˆ†ç±»']})"
                        ))
                    
                    # åˆ›å»ºé›·è¾¾å›¾
                    radar_fig = go.Figure(data=radar_data)
                    radar_fig.update_layout(
                        polar=dict(
                            radialaxis=dict(
                                visible=True,
                                range=[0, 1]
                            )
                        ),
                        title="äº§å“å·¥è‰ºå¤šç»´åº¦å¯¹æ¯”é›·è¾¾å›¾",
                        showlegend=True,
                        height=500
                    )
                    
                    st.plotly_chart(radar_fig, use_container_width=True)
                else:
                    st.warning("è¯·é€‰æ‹©è‡³å°‘3ä¸ªæŒ‡æ ‡è¿›è¡Œé›·è¾¾å›¾å¯¹æ¯”")
            
            with tab3:
                st.subheader("è¯¦ç»†å·¥è‰ºæ­¥éª¤å¯¹æ¯”")
                
                # é€‰æ‹©è¦å¯¹æ¯”è¯¦ç»†æ­¥éª¤çš„äº§å“
                selected_detailed = st.selectbox(
                    "é€‰æ‹©äº§å“æŸ¥çœ‹è¯¦ç»†æ­¥éª¤",
                    comparison_df["äº§å“åç§°"].tolist()
                )
                
                if selected_detailed:
                    # æ‰¾åˆ°å¯¹åº”çš„ä¸»åˆ†ç±»å’Œäº§å“
                    for product_path in selected_comparison:
                        parts = product_path.split(" | ")
                        if len(parts) == 2 and parts[1] == selected_detailed:
                            main_cat = parts[0]
                            product_info = PharmaceuticalProcesses.get_product_info(main_cat, selected_detailed)
                            
                            if product_info:
                                steps = product_info.get("å·¥è‰ºæ­¥éª¤", [])
                                
                                st.write(f"### {selected_detailed} è¯¦ç»†å·¥è‰ºæ­¥éª¤")
                                
                                # åˆ›å»ºæ­¥éª¤å¯¹æ¯”è¡¨æ ¼
                                step_data = []
                                for i, step in enumerate(steps, 1):
                                    step_data.append({
                                        "æ­¥éª¤é¡ºåº": i,
                                        "æ­¥éª¤åç§°": step["name"],
                                        "å…³é”®å‚æ•°æ•°": len(step.get("å…³é”®å‚æ•°", [])),
                                        "è®¾å¤‡æ•°": len(step.get("è®¾å¤‡", [])),
                                        "å…³é”®å‚æ•°ç¤ºä¾‹": ", ".join(step.get("å…³é”®å‚æ•°", [])[:3]) + ("..." if len(step.get("å…³é”®å‚æ•°", [])) > 3 else ""),
                                        "ä¸»è¦è®¾å¤‡": ", ".join(step.get("è®¾å¤‡", [])[:2]) + ("..." if len(step.get("è®¾å¤‡", [])) > 2 else "")
                                    })
                                
                                step_df = pd.DataFrame(step_data)
                                
                                st.dataframe(
                                    step_df,
                                    column_config={
                                        "æ­¥éª¤é¡ºåº": st.column_config.NumberColumn("åºå·"),
                                        "æ­¥éª¤åç§°": st.column_config.TextColumn("æ­¥éª¤åç§°"),
                                        "å…³é”®å‚æ•°æ•°": st.column_config.NumberColumn("å‚æ•°æ•°"),
                                        "è®¾å¤‡æ•°": st.column_config.NumberColumn("è®¾å¤‡æ•°"),
                                        "å…³é”®å‚æ•°ç¤ºä¾‹": st.column_config.TextColumn(
                                            "å…³é”®å‚æ•°",
                                            width="medium"
                                        ),
                                        "ä¸»è¦è®¾å¤‡": st.column_config.TextColumn(
                                            "ä¸»è¦è®¾å¤‡",
                                            width="medium"
                                        )
                                    },
                                    use_container_width=True,
                                    hide_index=True
                                )
                            
                            break
                
                # æ­¥éª¤æ•°åˆ†å¸ƒå¯¹æ¯”
                st.subheader("å„äº§å“å·¥è‰ºæ­¥éª¤åˆ†å¸ƒå¯¹æ¯”")
                
                # æ”¶é›†æ‰€æœ‰äº§å“çš„æ­¥éª¤æ•°
                all_steps_data = []
                for product_path in selected_comparison:
                    parts = product_path.split(" | ")
                    if len(parts) == 2:
                        main_cat, product = parts
                        product_info = PharmaceuticalProcesses.get_product_info(main_cat, product)
                        if product_info:
                            steps = product_info.get("å·¥è‰ºæ­¥éª¤", [])
                            all_steps_data.append({
                                "äº§å“": product,
                                "åˆ†ç±»": main_cat,
                                "æ­¥éª¤æ•°": len(steps)
                            })
                
                if all_steps_data:
                    steps_df = pd.DataFrame(all_steps_data)
                    
                    fig3 = px.box(
                        steps_df,
                        x="åˆ†ç±»",
                        y="æ­¥éª¤æ•°",
                        color="åˆ†ç±»",
                        points="all",
                        title="å„ç±»äº§å“å·¥è‰ºæ­¥éª¤æ•°åˆ†å¸ƒ"
                    )
                    
                    st.plotly_chart(fig3, use_container_width=True)
    
    else:
        st.info("è¯·åœ¨ä¾§è¾¹æ é€‰æ‹©è¦å¯¹æ¯”çš„äº§å“")

else:  # åˆ†ç±»æ¦‚è§ˆ
    st.header("ğŸŒ åˆ¶è¯å“ç±»å·¥è‰ºæ¦‚è§ˆ")
    
    # è·å–æ‰€æœ‰äº§å“æ•°æ®ç”¨äºæ¦‚è§ˆåˆ†æ
    all_products_data = []
    
    for main_cat in PharmaceuticalProcesses.get_main_categories():
        for product in PharmaceuticalProcesses.get_products(main_cat):
            product_info = PharmaceuticalProcesses.get_product_info(main_cat, product)
            if product_info:
                steps = product_info.get("å·¥è‰ºæ­¥éª¤", [])
                all_products_data.append({
                    "äº§å“": product,
                    "åˆ†ç±»": main_cat,
                    "å­åˆ†ç±»": main_cat.split("-")[-1] if "-" in main_cat else main_cat,
                    "æ­¥éª¤æ•°": len(steps),
                    "å…³é”®å‚æ•°æ€»æ•°": sum(len(step.get("å…³é”®å‚æ•°", [])) for step in steps),
                    "è®¾å¤‡ç§ç±»æ•°": len(set([equip for step in steps for equip in step.get("è®¾å¤‡", [])]))
                })
    
    if all_products_data:
        overview_df = pd.DataFrame(all_products_data)
        
        # æ ¹æ®æ¦‚è§ˆç±»å‹æ˜¾ç¤ºä¸åŒå›¾è¡¨
        if 'overview_type' in locals() and overview_type == "å·¥è‰ºæ­¥éª¤æ•°å¯¹æ¯”":
            st.subheader("å„å“ç±»å·¥è‰ºæ­¥éª¤æ•°å¯¹æ¯”")
            
            # æŒ‰åˆ†ç±»ç»Ÿè®¡å¹³å‡æ­¥éª¤æ•°
            category_stats = overview_df.groupby("åˆ†ç±»").agg({
                "æ­¥éª¤æ•°": ["mean", "min", "max", "count"]
            }).round(1).reset_index()
            
            category_stats.columns = ["åˆ†ç±»", "å¹³å‡æ­¥éª¤æ•°", "æœ€å°‘æ­¥éª¤æ•°", "æœ€å¤šæ­¥éª¤æ•°", "äº§å“æ•°é‡"]
            
            # æ˜¾ç¤ºç»Ÿè®¡è¡¨
            st.dataframe(category_stats, use_container_width=True)
            
            # åˆ›å»ºåˆ†ç±»å¯¹æ¯”å›¾
            fig = px.bar(
                category_stats,
                x="åˆ†ç±»",
                y="å¹³å‡æ­¥éª¤æ•°",
                error_y="æœ€å¤šæ­¥éª¤æ•°",
                title="å„åˆ†ç±»å¹³å‡å·¥è‰ºæ­¥éª¤æ•°å¯¹æ¯”",
                color="åˆ†ç±»",
                text="å¹³å‡æ­¥éª¤æ•°",
                hover_data=["äº§å“æ•°é‡", "æœ€å°‘æ­¥éª¤æ•°"]
            )
            
            fig.update_traces(textposition='outside')
            fig.update_layout(
                xaxis_title="äº§å“åˆ†ç±»",
                yaxis_title="å¹³å‡å·¥è‰ºæ­¥éª¤æ•°",
                showlegend=False
            )
            
            st.plotly_chart(fig, use_container_width=True)
            
        elif overview_type == "å·¥è‰ºå¤æ‚åº¦é›·è¾¾å›¾":
            st.subheader("å·¥è‰ºå¤æ‚åº¦å¤šç»´åº¦åˆ†æ")
            
            # é€‰æ‹©è¦åˆ†æçš„äº§å“
            selected_products = st.multiselect(
                "é€‰æ‹©äº§å“è¿›è¡Œå¤æ‚åº¦åˆ†æ",
                overview_df["äº§å“"].tolist(),
                default=overview_df["äº§å“"].tolist()[:5] if len(overview_df) >= 5 else overview_df["äº§å“"].tolist()
            )
            
            if selected_products:
                selected_df = overview_df[overview_df["äº§å“"].isin(selected_products)]
                
                # åˆ›å»ºé›·è¾¾å›¾
                radar_metrics = ["æ­¥éª¤æ•°", "å…³é”®å‚æ•°æ€»æ•°", "è®¾å¤‡ç§ç±»æ•°"]
                
                radar_data = []
                for _, row in selected_df.iterrows():
                    values = [row["æ­¥éª¤æ•°"], row["å…³é”®å‚æ•°æ€»æ•°"], row["è®¾å¤‡ç§ç±»æ•°"]]
                    
                    # æ ‡å‡†åŒ–
                    max_vals = selected_df[["æ­¥éª¤æ•°", "å…³é”®å‚æ•°æ€»æ•°", "è®¾å¤‡ç§ç±»æ•°"]].max()
                    min_vals = selected_df[["æ­¥éª¤æ•°", "å…³é”®å‚æ•°æ€»æ•°", "è®¾å¤‡ç§ç±»æ•°"]].min()
                    
                    normalized_values = []
                    for i, metric in enumerate(radar_metrics):
                        if max_vals[i] > min_vals[i]:
                            norm_val = (values[i] - min_vals[i]) / (max_vals[i] - min_vals[i])
                        else:
                            norm_val = 0.5
                        normalized_values.append(norm_val)
                    
                    radar_data.append(go.Scatterpolar(
                        r=normalized_values + [normalized_values[0]],
                        theta=radar_metrics + [radar_metrics[0]],
                        fill='toself',
                        name=f"{row['äº§å“']} ({row['åˆ†ç±»']})"
                    ))
                
                radar_fig = go.Figure(data=radar_data)
                radar_fig.update_layout(
                    polar=dict(
                        radialaxis=dict(
                            visible=True,
                            range=[0, 1]
                        )
                    ),
                    title="äº§å“å·¥è‰ºå¤æ‚åº¦é›·è¾¾å›¾",
                    showlegend=True,
                    height=500
                )
                
                st.plotly_chart(radar_fig, use_container_width=True)
        
        elif overview_type == "è®¾å¤‡éœ€æ±‚å¯¹æ¯”":
            st.subheader("è®¾å¤‡éœ€æ±‚åˆ†æ")
            
            # åˆ›å»ºè®¾å¤‡éœ€æ±‚çƒ­åŠ›å›¾
            fig = px.density_heatmap(
                overview_df,
                x="åˆ†ç±»",
                y="æ­¥éª¤æ•°",
                z="è®¾å¤‡ç§ç±»æ•°",
                title="è®¾å¤‡éœ€æ±‚ä¸å·¥è‰ºå¤æ‚åº¦å…³ç³»",
                color_continuous_scale="Viridis"
            )
            
            st.plotly_chart(fig, use_container_width=True)
            
            # æ˜¾ç¤ºè®¾å¤‡éœ€æ±‚æ’å
            st.subheader("è®¾å¤‡éœ€æ±‚æ’å")
            
            # æŒ‰äº§å“æ’åºæ˜¾ç¤ºè®¾å¤‡éœ€æ±‚
            sorted_df = overview_df.sort_values("è®¾å¤‡ç§ç±»æ•°", ascending=False)
            
            col1, col2 = st.columns(2)
            
            with col1:
                st.write("**è®¾å¤‡éœ€æ±‚æœ€é«˜çš„äº§å“:**")
                top_5 = sorted_df.head(5)
                for _, row in top_5.iterrows():
                    st.write(f"- {row['äº§å“']} ({row['åˆ†ç±»']}): {row['è®¾å¤‡ç§ç±»æ•°']}ç§è®¾å¤‡")
            
            with col2:
                st.write("**è®¾å¤‡éœ€æ±‚æœ€ä½çš„äº§å“:**")
                bottom_5 = sorted_df.tail(5)
                for _, row in bottom_5.iterrows():
                    st.write(f"- {row['äº§å“']} ({row['åˆ†ç±»']}): {row['è®¾å¤‡ç§ç±»æ•°']}ç§è®¾å¤‡")
    else:
        st.info("æš‚æ— æ•°æ®å¯ç”¨äºæ¦‚è§ˆåˆ†æ")

# é¡µè„š
st.markdown("---")
st.markdown(
    """
    <div style='text-align: center'>
        <p>âš—ï¸ åˆ¶è¯å·¥è‰ºæµç¨‹å¯¹æ¯”ç³»ç»Ÿ | ä¸“æ³¨äºå±•ç¤ºä¸åŒåˆ¶è¯å“ç±»çš„å·¥è‰ºå·®å¼‚</p>
        <p style='font-size: 0.9em; color: #666;'>
            æ•°æ®æ¥æº: åˆ¶è¯å·¥è‰ºä¸“ä¸šèµ„æ–™æ•´ç† | ç‰ˆæœ¬ 1.0 | æ›´æ–°æ—¥æœŸ: 2024å¹´
        </p>
        <p style='font-size: 0.8em; color: #999;'>
            æ¶µç›–åŒ–å­¦è¯ç‰©ã€ç”Ÿç‰©åˆ¶å“ã€ä¸­è¯ã€æ–°å‹åˆ¶å‰‚ç­‰å…¨å“ç±»ç”Ÿäº§å·¥è‰º
        </p>
    </div>
    """,
    unsafe_allow_html=True
)
